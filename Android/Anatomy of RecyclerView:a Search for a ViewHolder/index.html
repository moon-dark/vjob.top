<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=http://vjob.top/Android/Anatomy%20of%20RecyclerView%3Aa%20Search%20for%20a%20ViewHolder/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.1"><title>Anatomy of RecyclerView:a Search for a ViewHolder - 微站</title><link rel=stylesheet href=../../assets/stylesheets/main.e8d9bf0c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Source Code Pro"}</style><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#anatomy-of-recyclerviewa-search-for-a-viewholder class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=微站 class="md-header__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../static/img/avatar.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 微站 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Anatomy of RecyclerView:a Search for a ViewHolder </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85Ubuntu%20mate15.10-%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0_machh%E7%9A%84%E4%B8%93%E6%A0%8F-CSDN%E5%8D%9A%E5%AE%A2/ class=md-tabs__link> 树莓派 </a> </li> <li class=md-tabs__item> <a href=../Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class="md-tabs__link md-tabs__link--active"> Android </a> </li> <li class=md-tabs__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-tabs__link> Bash </a> </li> <li class=md-tabs__item> <a href=../../other/CTF%E5%B8%B8%E7%94%A8RSA%E6%8A%80%E5%B7%A7/ class=md-tabs__link> 安全 </a> </li> <li class=md-tabs__item> <a href=../../other/How%20to%20Get%20Rich/ class=md-tabs__link> 其它 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=微站 class="md-nav__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../static/img/avatar.png alt=logo> </a> 微站 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> 主页 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主页 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 主页 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> 微站 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8%E6%A0%91%E8%8E%93%E6%B4%BE%EF%BC%93B/ class=md-nav__link> 树莓派 </a> </li> <li class=md-nav__item> <a href=../Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Android </a> </li> <li class=md-nav__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-nav__link> Bash </a> </li> <li class=md-nav__item> <a href=../Mobile%20Application%20Penetration%20Testing%20Cheat%20sheet%20with%20Tools%20%26%20Resources/ class=md-nav__link> 安全 </a> </li> <li class=md-nav__item> <a href=../../other/How%20to%20Get%20Rich/ class=md-nav__link> 其它 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> 树莓派 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=树莓派 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 树莓派 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85Ubuntu%20mate15.10-%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0_machh%E7%9A%84%E4%B8%93%E6%A0%8F-CSDN%E5%8D%9A%E5%AE%A2/ class=md-nav__link> 树莓派安装Ubuntu mate15.10 系统笔记 machh的专栏 CSDN博客 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8%E6%A0%91%E8%8E%93%E6%B4%BE%EF%BC%93B/ class=md-nav__link> 硬盘启动树莓派３B </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85JDK/ class=md-nav__link> 树莓派安装JDK </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%B0%86%E6%A0%91%E8%8E%93%E6%B4%BERaspberry%20Pi%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8%28WiFi%E7%83%AD%E7%82%B9AP%2CRTL8188CUS%E8%8A%AF%E7%89%87%29/ class=md-nav__link> 将树莓派Raspberry Pi设置为无线路由器(WiFi热点AP,RTL8188CUS芯片) </a> </li> <li class=md-nav__item> <a href=../../RPI/Using%20Raspberry%20Pi%20for%20Laravel%20developing/ class=md-nav__link> Using Raspberry Pi for Laravel developing </a> </li> <li class=md-nav__item> <a href=../../RPI/VNC%20setup%20on%20Raspberry%20Pi%20from%20Ubuntu/ class=md-nav__link> VNC setup on Raspberry Pi from Ubuntu </a> </li> <li class=md-nav__item> <a href=../../RPI/%E8%AE%BE%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8%E5%A4%96%E7%BD%AE%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8/ class=md-nav__link> 设置树莓派使用外置硬盘启动 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%8A%8A%E6%A0%91%E8%8E%93%E6%B4%BE%E5%8F%98%E6%88%9024%E5%B0%8F%E6%97%B6%E8%BF%90%E8%A1%8C%E7%9A%84%E4%B8%8B%E8%BD%BD%E7%A5%9E%E5%99%A8%EF%BC%88%E7%A7%8D%E5%AD%90%E3%80%81%E7%A3%81%E5%8A%9B%E9%93%BE%E9%80%9A%E9%80%9A%E6%94%AF%E6%8C%81%EF%BC%89/ class=md-nav__link> 把树莓派变成24小时运行的下载神器（种子、磁力链通通支持） </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE2%E4%B8%8A%E5%AE%89%E8%A3%85%20Chromium%20%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%8A%20Google%20%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5%E6%B3%95/ class=md-nav__link> 在树莓派2上安装 Chromium 浏览器及 Google 拼音输入法 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%B8%BA%E6%A0%91%E8%8E%93%E6%B4%BEDIY%E4%B8%80%E6%AC%BE%E9%AB%98%E9%80%9F%E7%A8%B3%E5%AE%9A%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1/ class=md-nav__link> 为树莓派DIY一款高速稳定的无线网卡 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B6%E2%80%94%E2%80%94%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9_%E8%80%81%E5%BE%902014-CSDN%E5%8D%9A%E5%AE%A2_%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9/ class=md-nav__link> 树莓派开发系列教程6——树莓派做wifi热点 老徐2014 CSDN博客 树莓派做wifi热点 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BEwifi%E7%A0%B4%E8%A7%A3%E6%95%B4%E7%90%86%20-%20FindHao/ class=md-nav__link> 树莓派wifi破解整理 FindHao </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%A6%99%E6%A9%99%E6%B4%BE%E6%97%A0%E7%BA%BF%E6%92%AD%E6%94%BE%EF%BC%8C%E5%AE%9E%E7%8E%B0DLNA%E4%B8%8EAirPlay%E5%8D%8F%E8%AE%AE%E6%97%A0%E7%BA%BF%E9%9F%B3%E7%AE%B1/ class=md-nav__link> 树莓派香橙派无线播放，实现DLNA与AirPlay协议无线音箱 </a> </li> <li class=md-nav__item> <a href=../../RPI/SSH%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5/ class=md-nav__link> SSH通过代理连接 </a> </li> <li class=md-nav__item> <a href=../../RPI/Autossh%20and%20Systemd%20Service/ class=md-nav__link> Autossh and Systemd Service </a> </li> <li class=md-nav__item> <a href=../../RPI/Copying%20MySQL%20Databases%20to%20Another%20Machine/ class=md-nav__link> Copying MySQL Databases to Another Machine </a> </li> <li class=md-nav__item> <a href=../../RPI/How%20To%20Move%20a%20MySQL%20Data%20Directory%20to%20a%20New%20Location%20on%20Ubuntu%2016.04/ class=md-nav__link> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 </a> </li> <li class=md-nav__item> <a href=../../RPI/Latest%20Version%20of%20Firefox%20and%20Thunderbird%20on%20a%20Raspberry%20Pi%20%5Bobsolete%5D/ class=md-nav__link> Latest Version of Firefox and Thunderbird on a Raspberry Pi [obsolete] </a> </li> <li class=md-nav__item> <a href=../../RPI/OpenWrt%20%E4%BD%BF%E7%94%A8%20frp%20%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%20%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA/ class=md-nav__link> OpenWrt 使用 frp 实现内网穿透 准备工作 搭建内网穿透 文章评论 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E8%A7%A3%E5%86%B3%E6%A0%91%E8%8E%93%E6%B4%BESSH%E7%99%BB%E5%BD%95%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98_Maoning%20Guan%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2/ class=md-nav__link> 解决树莓派SSH登录缓慢的问题 Maoning Guan的博客 CSDN博客 </a> </li> <li class=md-nav__item> <a href=../../RPI/Reading%20privileged%20memory%20with%20a%20side-channel/ class=md-nav__link> Reading privileged memory with a side channel </a> </li> <li class=md-nav__item> <a href=../../RPI/Install%20Latest%20ReadyMedia%20miniDLNA%20Raspberry%20Pi/ class=md-nav__link> Install Latest ReadyMedia miniDLNA Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%BD%BF%E7%94%A8%20vcgencmd%20%E6%8C%87%E4%BB%A4%E6%9F%A5%E7%9C%8B%20Raspberry%20Pi%20%E7%9A%84%20CPU%20%E6%BA%AB%E5%BA%A6%E3%80%81%E9%81%8B%E8%A1%8C%E9%80%9F%E5%BA%A6%E8%88%87%E9%9B%BB%E5%A3%93%E7%AD%89%E8%B3%87%E8%A8%8A/ class=md-nav__link> 使用 vcgencmd 指令查看 Raspberry Pi 的 CPU 溫度、運行速度與電壓等資訊 </a> </li> <li class=md-nav__item> <a href=../../RPI/Aria2%20%E7%BC%96%E8%AF%91%20%E6%B7%BB%E5%8A%A0%E6%94%AF%E6%8C%81BT%E4%B8%8B%E8%BD%BD%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%88X86%E5%92%8Carmhf%E7%9A%84%E6%A0%91%E8%8E%93%E6%B4%BE2%EF%BC%89/ class=md-nav__link> Aria2 编译 添加支持BT下载的功能（X86和armhf的树莓派2） </a> </li> <li class=md-nav__item> <a href=../../RPI/Let%27s%20Encrypt%EF%BC%8C%E5%85%8D%E8%B4%B9%E5%A5%BD%E7%94%A8%E7%9A%84%20HTTPS%20%E8%AF%81%E4%B9%A6/ class=md-nav__link> Let's Encrypt，免费好用的 HTTPS 证书 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%BD%BF%E7%94%A8SSH%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93%E8%BF%9B%E8%A1%8C%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> 使用SSH反向隧道进行内网穿透 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%A9%E7%94%A8nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%8C%E6%88%90%E4%B8%BAIPv6_IPv4%E5%85%AC%E7%BD%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E9%9C%80%E8%A6%81%E8%BF%9C%E7%A8%8B%E5%8F%8C%E6%A0%88%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89/ class=md-nav__link> 树莓派利用nginx反向代理，成为IPv6 IPv4公网服务器（需要远程双栈服务器） </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E6%90%AD%E5%BB%BA%20WordPress/ class=md-nav__link> 如何在树莓派上搭建 WordPress </a> </li> <li class=md-nav__item> <a href=../../RPI/Install%20Redis%20on%20your%20Raspberry%20Pi/ class=md-nav__link> Install Redis on your Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE4%E5%8F%98%E8%BA%AB%E6%97%81%E8%B7%AF%E7%94%B1/ class=md-nav__link> 树莓派4变身旁路由 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Android10源码下载 </a> </li> <li class=md-nav__item> <a href=../%E5%B1%8F%E5%B9%95%E5%9D%8F%E4%B8%80%E5%8A%A0%E6%89%8B%E6%9C%BA%E5%88%B7android10/ class=md-nav__link> 屏幕坏一加手机刷android10 </a> </li> <li class=md-nav__item> <a href=../Enable%20ADB%20from%20recovery/ class=md-nav__link> Enable ADB from recovery </a> </li> <li class=md-nav__item> <a href=../Android%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E5%92%8Croot%E6%9D%83%E9%99%90/ class=md-nav__link> Android系统权限和root权限 </a> </li> <li class=md-nav__item> <a href=../%E3%80%90Android%20ROM%E5%AE%9A%E5%88%B6%E3%80%91CyanogenMod%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%92%8C%E7%BC%96%E8%AF%91/ class=md-nav__link> 【Android ROM定制】CyanogenMod源码下载和编译 </a> </li> <li class=md-nav__item> <a href=../android%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/ class=md-nav__link> Android内存泄露优化总结 </a> </li> <li class=md-nav__item> <a href=../%E6%97%A5%E7%A7%AF%E6%9C%88%E7%B4%AF%EF%BC%9AProguard%E8%BF%9B%E8%A1%8C%E6%BA%90%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E5%92%8C%E5%B4%A9%E6%BA%83%E6%97%A5%E5%BF%97%E5%8F%8D%E6%B7%B7%E6%B7%86/ class=md-nav__link> 日积月累：Proguard进行源代码混淆和崩溃日志反混淆 </a> </li> <li class=md-nav__item> <a href=../10%20Ways%20to%20Improve%20Your%20Android%20App%27s%20Performance/ class=md-nav__link> 10 Ways to Improve Your Android App's Performance </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Anatomy of RecyclerView:a Search for a ViewHolder <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Anatomy of RecyclerView:a Search for a ViewHolder </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#anatomy-of-recyclerviewa-search-for-a-viewholder class=md-nav__link> Anatomy of RecyclerView:a Search for a ViewHolder </a> </li> <li class=md-nav__item> <a href=#15-min-readanatomy-of-recyclerview-a-search-for-a-viewholder class=md-nav__link> ·15 min readAnatomy of RecyclerView: a Search for a ViewHolder </a> </li> <li class=md-nav__item> <a href=#intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=#recycledviewpool class=md-nav__link> RecycledViewPool </a> </li> <li class=md-nav__item> <a href=#offtopic-pre-layout-post-layout-and-predictive-animations class=md-nav__link> Offtopic: pre-layout, post-layout and predictive animations </a> </li> <li class=md-nav__item> <a href=#recycledviewpool-continued class=md-nav__link> RecycledViewPool, continued </a> </li> <li class=md-nav__item> <a href=#view-cache class=md-nav__link> View Cache </a> </li> <li class=md-nav__item> <a href=#pool-and-cache-in-action class=md-nav__link> Pool and Cache in Action </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Android%E6%8F%92%E4%BB%B6%E5%8C%96%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94Hook%E6%9C%BA%E5%88%B6%E4%B9%8BBinder%20Hook/ class=md-nav__link> Android插件化原理解析——Hook机制之Binder Hook </a> </li> <li class=md-nav__item> <a href=../%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%BD%93%E5%BE%AE%E4%BF%A1%E8%BF%90%E5%8A%A8%E7%AC%AC%E4%B8%80%E5%90%8D%E2%80%93%E5%88%A9%E7%94%A8AndroidHook%E8%BF%9B%E8%A1%8C%E5%BE%AE%E4%BF%A1%E8%BF%90%E5%8A%A8%E4%BD%9C%E5%BC%8A/ class=md-nav__link> 手把手教你当微信运动第一名–利用AndroidHook进行微信运动作弊 </a> </li> <li class=md-nav__item> <a href=../%E9%BB%91%E5%AE%A2%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E4%B8%89%E6%98%9F%E9%A2%84%E8%A3%85%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9D%A5%E7%9B%91%E8%A7%86%E7%94%A8%E6%88%B7/ class=md-nav__link> 黑客可以利用三星预装的应用程序来监视用户 </a> </li> <li class=md-nav__item> <a href=../Android%20%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93%20Android%20%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93/ class=md-nav__link> Android 动画总结 Android 动画总结 </a> </li> <li class=md-nav__item> <a href=../Android%E7%AD%BE%E5%90%8D%E6%80%BB%E7%BB%93/ class=md-nav__link> Android签名总结 </a> </li> <li class=md-nav__item> <a href=../Am%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95/ class=md-nav__link> Am命令用法 </a> </li> <li class=md-nav__item> <a href=../10%20Tips%20for%20using%20the%20Eclipse%20Memory%20Analyzer/ class=md-nav__link> 10 Tips for using the Eclipse Memory Analyzer </a> </li> <li class=md-nav__item> <a href=../android%E4%BD%BF%E7%94%A8ndk-stack%E8%B0%83%E8%AF%95JNI%E9%83%A8%E5%88%86%E7%9A%84C_C%2B%2B%E4%BB%A3%E7%A0%81/ class=md-nav__link> android使用ndk stack调试JNI部分的C C++代码 </a> </li> <li class=md-nav__item> <a href=../NativeActivity%E5%8E%9F%E7%90%86/ class=md-nav__link> NativeActivity原理 </a> </li> <li class=md-nav__item> <a href=../Using%20data%20binding%20in%20Android/ class=md-nav__link> Using data binding in Android </a> </li> <li class=md-nav__item> <a href=../Android%E4%B8%8AWebRTC%E4%BB%8B%E7%BB%8D/ class=md-nav__link> Android上WebRTC介绍 </a> </li> <li class=md-nav__item> <a href=../CoordinatorLayout%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95-%E8%87%AA%E5%AE%9A%E4%B9%89Behavior/ class=md-nav__link> CoordinatorLayout高级用法 自定义Behavior </a> </li> <li class=md-nav__item> <a href=../OpenSSL%E5%AE%9E%E8%B7%B5-Android%E4%B8%8B%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E4%BD%BF%E7%94%A8/ class=md-nav__link> OpenSSL实践 Android下的编译和使用 </a> </li> <li class=md-nav__item> <a href=../%E4%BD%BF%E7%94%A8ShareSDK%E5%AE%8C%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%88QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%EF%BC%89%E7%99%BB%E5%BD%95%E5%92%8C%E5%88%86%E4%BA%AB/ class=md-nav__link> 使用ShareSDK完成第三方（QQ、微信、微博）登录和分享 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Bash <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bash data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Bash </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-nav__link> 应该知道的Linux技巧 </a> </li> <li class=md-nav__item> <a href=../../Bash/%E4%BC%98%E9%9B%85%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%EF%BC%9ATmux%20%E7%BB%88%E7%AB%AF%E5%A4%8D%E7%94%A8/ class=md-nav__link> 优雅地使用命令行：Tmux 终端复用 </a> </li> <li class=md-nav__item> <a href=../../Bash/%E6%88%91%E7%9A%84ImageMagick%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/ class=md-nav__link> 我的ImageMagick使用心得 </a> </li> <li class=md-nav__item> <a href=../../Bash/gdbcomm/ class=md-nav__link> Gdbcomm </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> 安全 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安全 data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/CTF%E5%B8%B8%E7%94%A8RSA%E6%8A%80%E5%B7%A7/ class=md-nav__link> CTF常用RSA技巧 </a> </li> <li class=md-nav__item> <a href=../../other/RSA/ class=md-nav__link> RSA </a> </li> <li class=md-nav__item> <a href=../../other/SageMath%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/ class=md-nav__link> SageMath常用函数 </a> </li> <li class=md-nav__item> <a href=../Mobile%20Application%20Penetration%20Testing%20Cheat%20sheet%20with%20Tools%20%26%20Resources/ class=md-nav__link> Mobile Application Penetration Testing Cheat sheet with Tools & Resources </a> </li> <li class=md-nav__item> <a href=../../other/Most%20Important%20Network%20Penetration%20Testing%20Tools%20for%20Hackers%20%26%20Security%20Professionals/ class=md-nav__link> Most Important Network Penetration Testing Tools for Hackers & Security Professionals </a> </li> <li class=md-nav__item> <a href=../../other/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E5%AE%9E%E9%AA%8C/ class=md-nav__link> 缓冲区溢出攻击实验 </a> </li> <li class=md-nav__item> <a href=../../other/%E5%B7%A7%E7%94%A8%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%9A%84N%E7%A7%8D%E6%96%B9%E5%BC%8F/ class=md-nav__link> 巧用命令注入的N种方式 </a> </li> <li class=md-nav__item> <a href=../../other/Smashing%20the%20Stack%20for%20Fun%20and%20Profit%20by%20Aleph%20One/ class=md-nav__link> Smashing the Stack for Fun and Profit by Aleph One </a> </li> <li class=md-nav__item> <a href=../Bad%20Binder%3AAndroid%20In-The-Wild%20Exploit/ class=md-nav__link> Bad Binder:Android In The Wild Exploit </a> </li> <li class=md-nav__item> <a href=../../other/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%99%E7%82%B9%E6%94%B6%E9%9B%86/ class=md-nav__link> 信息安全站点收集 </a> </li> <li class=md-nav__item> <a href=../../other/%E7%8E%8B%E5%AD%90%E4%BA%AD%E7%9A%84%E5%8D%9A%E5%AE%A2%20GPG%20%E4%B8%8E%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8A%A0%E5%AF%86%EF%BC%9A%E8%AE%BA%E4%BB%80%E4%B9%88%E6%89%8D%E6%98%AF%E5%8F%AF%E4%BB%A5%E4%BF%A1%E4%BB%BB%E7%9A%84/ class=md-nav__link> 王子亭的博客 GPG 与端到端加密：论什么才是可以信任的 </a> </li> <li class=md-nav__item> <a href=../../other/nc%3A%20invalid%20option%20%E2%80%94%20%E2%80%98-%E2%80%98/ class=md-nav__link> Nc: invalid option — ‘ ‘ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> 其它 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其它 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 其它 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/How%20to%20Get%20Rich/ class=md-nav__link> How to Get Rich </a> </li> <li class=md-nav__item> <a href=../../other/TOP%2011%20Deep%20Web%20Search%20Engine%20Alternative%20for%20Google%20and%20Bing%202021/ class=md-nav__link> TOP 11 Deep Web Search Engine Alternative for Google and Bing 2021 </a> </li> <li class=md-nav__item> <a href=../../other/FFmpeg%E5%8A%9F%E8%83%BD%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/ class=md-nav__link> FFmpeg功能命令汇总 </a> </li> <li class=md-nav__item> <a href=../../other/%E4%B8%8D%E6%80%95%E5%A5%B8%E5%95%86%20%E6%8F%AD%E5%90%84%E5%93%81%E7%89%8C%E7%94%B5%E8%A7%86%E8%BF%9B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E6%96%B9%E6%B3%95/ class=md-nav__link> 不怕奸商 揭各品牌电视进工厂模式方法 </a> </li> <li class=md-nav__item> <a href=../../other/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/ class=md-nav__link> 傅里叶变换 </a> </li> <li class=md-nav__item> <a href=../../other/%E6%BB%A4%E6%B3%A2%E5%99%A8/ class=md-nav__link> 滤波器 </a> </li> <li class=md-nav__item> <a href=../../other/%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B/ class=md-nav__link> 蓝牙协议入门（一）简介 </a> </li> <li class=md-nav__item> <a href=../../other/%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（二）传输层协议 </a> </li> <li class=md-nav__item> <a href=../../other/%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E4%B8%AD%E4%BB%8B%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（三）中介层协议 </a> </li> <li class=md-nav__item> <a href=../../other/%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（四）应用层协议 </a> </li> <li class=md-nav__item> <a href=../../other/TarsosDSP%20%E7%AE%80%E4%BB%8B%203.TarsosDSP%20%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/ class=md-nav__link> TarsosDSP 简介 3.TarsosDSP 是如何工作的？ </a> </li> <li class=md-nav__item> <a href=../../tmp/%E5%AE%9E%E6%88%98rfc5766-turn-server%E5%92%8Cice4j%E5%B9%BF%E5%9F%9F%E7%BD%91%E9%80%9A%E8%AE%AF/ class=md-nav__link> 实战rfc5766 turn server和ice4j广域网通讯 </a> </li> <li class=md-nav__item> <a href=../../other/%E6%B3%A2%E9%BB%91%E5%9B%B4%E5%9F%8E%E6%88%98%E4%B8%AD%E7%9A%84%E5%B9%B8%E5%AD%98%E8%80%85/ class=md-nav__link> 波黑围城战中的幸存者 </a> </li> <li class=md-nav__item> <a href=../../other/%E6%AD%A6%E6%B1%89%EF%BC%9A%E7%99%BE%E5%B9%B4%E7%9A%84%E6%B4%AA%E6%B0%B4%E8%AE%B0%E5%BF%86/ class=md-nav__link> 武汉：百年的洪水记忆 </a> </li> <li class=md-nav__item> <a href=../../Python/python%E5%88%B6%E4%BD%9Cpdf%E7%94%B5%E5%AD%90%E4%B9%A6/ class=md-nav__link> Python制作pdf电子书 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#anatomy-of-recyclerviewa-search-for-a-viewholder class=md-nav__link> Anatomy of RecyclerView:a Search for a ViewHolder </a> </li> <li class=md-nav__item> <a href=#15-min-readanatomy-of-recyclerview-a-search-for-a-viewholder class=md-nav__link> ·15 min readAnatomy of RecyclerView: a Search for a ViewHolder </a> </li> <li class=md-nav__item> <a href=#intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=#recycledviewpool class=md-nav__link> RecycledViewPool </a> </li> <li class=md-nav__item> <a href=#offtopic-pre-layout-post-layout-and-predictive-animations class=md-nav__link> Offtopic: pre-layout, post-layout and predictive animations </a> </li> <li class=md-nav__item> <a href=#recycledviewpool-continued class=md-nav__link> RecycledViewPool, continued </a> </li> <li class=md-nav__item> <a href=#view-cache class=md-nav__link> View Cache </a> </li> <li class=md-nav__item> <a href=#pool-and-cache-in-action class=md-nav__link> Pool and Cache in Action </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h2 id=anatomy-of-recyclerviewa-search-for-a-viewholder>Anatomy of RecyclerView:a Search for a ViewHolder</h2> <p><a href="https://medium.com/@pavelshmakov?source=post_page-----404ba3453714-----------------------------------"><img alt="Pavel Shmakov" src=http://i.vjob.top:8000/imgs/20220306_1*DBICElmgAITvDrM5JoOUNg.png></a><a href="https://medium.com/@pavelshmakov?source=post_page-----404ba3453714-----------------------------------">Pavel Shmakov</a>FollowMar 11, 2017</p> <h1 id=15-min-readanatomy-of-recyclerview-a-search-for-a-viewholder>·15 min readAnatomy of RecyclerView: a Search for a ViewHolder</h1> <h1 id=intro><strong>Intro</strong></h1> <p>In this series of articles I’m going to share my knowledge of the inner workings of RecyclerView. Why? Just think about it: RecyclerView is needed almost in every modern Android app, so the way developers work with it affects the experience of millions and millions of users. And yet, what kind of educational material on RecyclerView do we have? You can surely find some basic tutorials on how to <em>use</em> RecyclerView, but what about <em>how it works</em>? The “black box” approach is definitely not good enough, especially if you are doing complex customizations or optimizing the performance.<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#aa26>¹</a> The “deepest” material out there is probably the <a href="https://www.youtube.com/watch?v=LqBlYJTfLP4">RecyclerView ins and outs</a> talk at Google I/O 2016, which I recommend, but seriously, that’s not even close to “ins and outs”, that’s just the tip of the iceberg. My goal is to go deeper than that.</p> <p>I assume that the reader has basic knowledge of RecyclerView, stuff like what LayoutManager is, how to notify Adapter of particular changes in data or how to use item view types.</p> <p>In this first part we will be figuring out what’s going on in just one method inside RecyclerView: <code>getViewByPosition()</code>. This is one of the most crucial bits of source code, and by studying it, we will learn about many aspects of RecyclerView, such as ViewHolder recycling, hidden views, predictive animations and stable ids. You may be surprised to see predictive animations here. Well, the thing is, despite the best efforts of guys at Google to decouple responsibilities of different components of RecyclerView, a lot of “knowledge” is still shared between them, predictive animations being one of those things. There is no way to avoid talking about them at one point or another.</p> <p>So, during laying items out the LayoutManager asks the RecyclerView “please give me a View at position 8”. And here is what RecycleView does in response:</p> <ol> <li>Searches <strong>changed scrap</strong></li> <li>Searches <strong>attached scrap</strong></li> <li>Searches non-removed <strong>hidden views</strong></li> <li>Searches the <strong>view cache</strong></li> <li>If Adapter has stable ids, searches <strong>attached scrap</strong> and <strong>view cache</strong> again for given id.</li> <li>Searches the <strong>ViewCacheExtension</strong></li> <li>Searches the <strong>RecycledViewPool</strong></li> </ol> <p>If it fails to find a suitable View in all of those places, it creates one by calling adapter’s <code>onCreateViewHolder()</code> method. It then binds the View via <code>onBindViewHolder()</code> if necessary, and finally returns it.</p> <p>As you see, there’s a lot going on here, much more than just one pool of reusable ViewHolders as one may have expected. Our goal is to figure out what all those caches are about, how they work and why they are needed. We’ll go through them one by one (in the order I think would be the best), and our first stop is the RecycledViewPool.</p> <h1 id=recycledviewpool><strong>RecycledViewPool</strong></h1> <p>We’d like to have an answer to a few questions about each kind of cache: what is its backing data structure, under which conditions the ViewHolders are stored there and retrieved from there, and, most importantly, what’s the purpose of it.</p> <p>You probably know the purpose of the pool very well: while scrolling, say, downwards the views that disappear on top are recycled into the pool to be reused for the views that emerge from the bottom. We’ll talk about other scenarios where ViewHolders go to the pool a little bit later. But first let’s take a look at some of the RecycledViewPool’s code (which is an inner class of RecyclerView.Recycler):</p> <pre><code>public static classRecycledViewPool {private SparseArray&lt;ArrayList&lt;ViewHolder&gt;&gt; mScrap =new SparseArray&lt;&gt;();private SparseIntArray mMaxScrap = new SparseIntArray(); …public ViewHolder getRecycledView(int viewType) {ArrayList&lt;ViewHolder&gt; scrapHeap = mScrap.get(viewType); …
</code></pre> <p>First of all, don’t let the name <code>mScrap</code> confuse you — this has nothing to do with attached or changed scrap mentioned in the list above.</p> <p>We see that each view type has its own pool of ViewHolders. When RecyclerView runs out of all other possibilities during a search for a ViewHolder, it asks the pool to give a ViewHolder with correct view type; at that point, view type is the only thing that matters.</p> <p>Now, each view type has it’s own capacity. It is 5 by default, but you can change it like that:</p> <pre><code>recyclerView.getRecycledViewPool()  
 .setMaxRecycledViews(***SOME_VIEW_TYPE***, ***POOL_CAPACITY***);
</code></pre> <p>This is a very important point of flexibility. If you have dozens of same-type items on screen, which often change simultaneously, make the pool bigger for that view type. And if you know, that items of some view type are so rare, that they never appear on screen in quantity more than one, set the pool size 1 for that view type. Otherwise sooner or later the pool will be filled with 5 of those items, and 4 of them will just sit there unused, which is a waste of memory.</p> <p>The methods <code>getRecyclerView()</code>, <code>putRecycledView()</code><em>,</em> <code>clear()</code>are public, so you can manipulate the contents of the pool. Using <code>putRecycledView()</code>manually, e.g. in order to prepare some ViewHolders beforehand, is a bad idea, though. You should create ViewHolder <em>only</em> in <code>onCreateViewHolder()</code>method of your Adapter, otherwise the ViewHolders can appear in states that RecyclerView doesn’t expect.<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#fe2a>²</a></p> <p>Another cool feature is that along with the getter <code>getRecycledViewPool()</code> there is a setter <code>setRecycledViewPool()</code>, so you can reuse a single pool for multiple RecycleViews.</p> <p>Finally, I’ll note that the pool for each view type works as a stack (last in — first out). We’ll see why this is good later.</p> <p><strong>Ways to pool</strong></p> <p>Now let’s address the question of when the ViewHolders are thrown into the pool. There are 5 scenarios:</p> <ol> <li>A view went out of RecyclerView’s bounds during scrolling.</li> <li>Data has changed so that the view is no longer seen. Addition to the pool happens when the disappearance animation finishes.</li> <li>An item in the view cache has been updated or removed.</li> <li>During a search for a ViewHolder, one was found in scrap or cache with position we want, but turned out to be unsuitable because of the wrong view type or id (if adapter has stable ids).<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#8b86>³</a></li> <li>The LayoutManager added a view at pre-layout, but didn’t add that view in post-layout.</li> </ol> <p>The first two scenarios are pretty obvious. One thing to note, though, is that scenario 2 is triggered not only by removal of an item in question, but also, for example, by insertion of other items, which push the given item out of bounds.</p> <p>The other scenarios require a bit of comment. We’ve not covered the view cache and scrap yet, but the idea behind scenarios 3 and 4 is simple. The pool is a place for the views we know to be “dirty” and requiring rebinding. ViewHolders in all caches, except for the pool, retain some of their state (most importantly, positions). All those caches are searched by position in hope that some ViewHolder can be reused as-is. By contrast, when a view goes to pool, it’s state (all the flags, position, etc.) is cleared. The only things that remain are associated view and the view type. The pool is searched by the view type, as we know, and when a ViewHolder is found there, it starts a new life.</p> <p>Given that picture, scenarios 3 and 4 shouldn’t be a mystery: for example, if we see a item in the view cache being removed, there’s no point in holding it in that cache any more, since it won’t be reused as-is for the same position. It’s not nice to throw it away completely, though, so we throw it into the pool instead.</p> <p>The last scenario requires us to know what pre-layout and post-layout are. Well, let’s just go ahead and figure that out! That scenario is definitely not the most crucial aspect of the pre/post-layout mechanism, but this mechanism is hugely important in general and is manifesting itself in every part of RecyclerView, so we’ll have to know it anyway.</p> <h1 id=offtopic-pre-layout-post-layout-and-predictive-animations><strong>Offtopic: pre-layout, post-layout and predictive animations</strong></h1> <p>Consider a scenario where we have items <em>a, b</em> and <em>c,</em> of which <em>a</em> and <em>b</em> fit on the screen. We delete the <em>b</em>, which brings <em>c</em> into view:</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*ZxzTdRCpireBVs4t.png> What we’d like to see is <em>c</em> smoothly sliding from the bottom up to it’s new place. But how can that happen? We know the final location of <em>c</em> from the new layout, but how do we know where it should slide from? It would be wrong of RecyclerView or ItemAnimator to just assume by looking at the new layout that <em>c</em> should come from the bottom. We might have some custom LayoutManager where it should come from the side or something. So we need some more help from the LayoutManager. Can we use the previous layout? No, there’s no <em>с</em> there. At that point no-one new that <em>b</em> was going to be deleted, so laying out <em>c</em> was rightly considered by LayoutManager to be a waste of resources.</p> <p>The solution guys at Google offered is as follows. After a change in the Adapter happens, the RecyclerView requests not one but two layouts from the LayoutManager. The first one — the pre-layout, lays out items in the previous adapter state, but uses the adapter changes as a hint that it might be a good idea to lay out some extra views. In our example, since we now know that <em>b</em> is being deleted, we additionally lay out <em>c</em>, despite the fact it’s out of bounds. The second one — the post-layout, is just a normal layout corresponding to the adapter state after the changes.</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*8dtqyWtaehYM-7zm.> Now, by comparing the locations of <em>c</em> in pre-layout and post-layout, we can animate its appearance properly.</p> <p>This kind of animation — when the animated view is not present either in previous layout or in the new one — is called <em>predictive animation,</em> which is one of the most important concepts in RecyclerView. We’ll discuss it in greater detail in later parts of this series. But now let’s quickly look at another example: what if <em>b</em> is changed instead of being deleted?</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*zzI5wYYr3KdkexZ4.> This might come as a surprise, but the LayoutManager still lays out <em>c</em> in the pre-layout phase. Why? Because maybe the change of <em>b</em> would make it become smaller in height, who knows? And if <em>b</em> becomes smaller, <em>c</em> might pop up from the bottom, so we better lay it out in pre-layout. But then later, in post-layout, it appeared to be not the case, say we just changed some TextView inside <em>b.</em> So <em>c</em> is not needed, and is thrown into the pool. That’s the scenario 5 of getting oneself into the pool. It is hopefully clear now and we can go back to the RecycledViewPool.</p> <h1 id=recycledviewpool-continued><strong>RecycledViewPool, continued</strong></h1> <p>When we encounter one of the scenarios when a ViewHolder should go to the pool, there are still two more obstacles on its way there: it might not be recyclable and it’s View might be in transient state.</p> <p><strong>Recyclability</strong></p> <p>Recyclability is just a flag in ViewHolder, that you can manipulate by using <code>setIsRecyclable()</code> method of ViewHolder class. RecycleView makes use of it as well, making ViewHolders non-recyclable during animations.</p> <p>Manipulating a single flag from different independent places is usually a bad idea. For example, RecyclerView calls <code>setIsRecyclable(true)</code> when animation ends, by you don’t want it to be recyclable for some reason specific to your application. But things don’t actually break in this case because calls to <code>setIsRecyclable()</code> are <em>paired.</em> That is, if you call <code>setIsRecyclable(false)</code> twice, then calling <code>setIsRecyclable(true)</code>only once doesn’t make the ViewHolder recyclable, you need to call it twice as well.</p> <p><strong>Transient state</strong></p> <p>The View’s transient state is a very similar thing. It’s a flag in the View, manipulated by <code>setHasTransientState()</code> method, and the calls are paired as well. The View class itself doesn’t use the flag, but just holds it. It serves as a hint for widgets like ListView and RecyclerView, that it’s better not to reuse this View for new content at this time.</p> <p>You can set this flag yourself, but also the ViewPropertyAnimator (that is when you do <code>someView.animate()…</code>) automatically sets it to true at the start and to false at the end of animation.<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#d49c>⁴</a> Note that if you use, for example, a ValueAnimator to animate your views, you would have to manage the transient state yourself.</p> <p>One last thing to note about the transient state is that it is propagated from children to parents, all the way up to the root view. So if you animate some internal view of an item in the list, not only that view, but the item’s root view, which a ViewHolder holds reference to, goes to transient state.</p> <p><strong>OnFailedToRecycleView</strong></p> <p>If a ViewHolder about to be recycled fails either recyclability or transient state check, the <code>onFailedToRecycleView()</code> method of your Adapter is called. Now, this is a really important point: this method is not just a notification of an event, but a question to you on how this situation should be dealt with.</p> <p>Returning <em>true</em> from <code>onFailedToRecycledView()</code> means “recycle it anyway”. One situation where this is appropriate is when you clear all the animations and other sources of this trouble when binding a new item. Alternatively, you can deal with these things right in the <code>onFailedToRecycledView()</code> method.</p> <p>What you shouldn’t do is to ignore <code>onFailedToRecycledView()</code> completely. One scenario in which that might hurt you is the following. Imagine you are fading in images in the items when they come into view. If the user scrolls your list fast enough, the images won’t finish fading in when they go out of view, rendering the ViewHolders ineligible for recycling. So you’ll have laggy scroll, and on top of that, new and new ViewHolders will be created, cluttering the memory. For Russian-speaking readers I recommend this talk by Konstantin Zaikin, where, among other things, this scenario is shown in action: <a href=https://events.yandex.ru/lib/talks/3456/ >https://events.yandex.ru/lib/talks/3456/</a></p> <p>Succeeding in recycling a ViewHolder leads to a call to <code>onViewRecycled()</code>method, which is a good place to release heavy resources, such as images. Remember that some ViewHolder instances can end up sitting in the pool for a long time without usage, which may be a big waste of memory.</p> <p>We now move on to the next cache — the <em>view cache.</em></p> <h1 id=view-cache><strong>View Cache</strong></h1> <p>When I say “view cache” or just “cache” what I refer to is <code>mCachedViews</code> field found in RecyclerView.Recycler class. It’s also called “first level cache” in some comments in the code.</p> <p>This is just an ArrayList of ViewHolders, no splitting by view types here. The default capacity is 2, and you can tweak it via <code>setItemViewCacheSize()</code> method of RecyclerView.</p> <p>As I mentioned before, the most important difference between the pool and other caches (including the view cache), is that those other caches are searched for a ViewHolder associated with given position, while the pool is searched by view type. When a ViewHolder is in the view cache, we hope to to reuse it “as-is”, without rebinding, at the same position as the one it was at before it got into the cache. So let’s make this distinction perfectly clear:</p> <ul> <li>If a ViewHolder was found <strong>nowhere</strong>, it is <strong>created</strong> and <strong>bound</strong>.</li> <li>If a ViewHolder was found in <strong>pool</strong>, it is <strong>bound</strong>.</li> <li>If a ViewHolder was found in <strong>cache</strong>, there is <strong>nothing</strong> to be done.</li> </ul> <p>At this point one important thing becomes very clear: a ViewHolder being bound and recycled into pool (<code>onViewRecycled()</code>) is <em>not</em> the same thing as an item in list going in and out of visible bounds. When it goes out, its ViewHolder can go to view cache instead of pool, and when it comes in, the ViewHolder is sometimes retrieved from view cache and is not bound. If you need to track the presence of items on screen, use the <code>onViewAttachedToWindow()</code> and <code>onViewDetachedFromWindow()</code> callbacks of your Adapter.</p> <p><strong>Filling pool and cache</strong></p> <p>Now, to the next question: how do ViewHolders end up in the view cache? When I was talking about the scenarios, which lead to the pool, I actually deceived you a little bit. In those scenarios (except for the third one) the ViewHolder goes either to the cache or to the pool.<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#24c3>⁵</a></p> <p>Let me illustrate the rules by which either the cache or the pool is selected. Say, we have empty pool and cache initially and recycle the items one by one. This is how the pool and the cache is filled (assuming default capacities and one view type):</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*JKHlomcG7gdcpA7h.> So, as long as the cache isn’t full, ViewHolders go there. If it’s full, a new ViewHolder pushes a ViewHolder from the “other end” of the cache into the pool. If a pool is already full, that ViewHolder is pushed into oblivion, to the garbage collector that is.<a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#db80>⁶</a></p> <h1 id=pool-and-cache-in-action><strong>Pool and Cache in Action</strong></h1> <p>Now let’s look at the way pool and cache behave in a couple of actual RecyclerView usage scenarios.</p> <p>Consider scrolling:</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*loJwYG5qlTLTRiTX.> As we scroll downwards, there is a “tail” behind the currently seen items consisting of cached items and then a pooled item. When the item 8 appears on screen, no suitable ViewHolder is found in cache: no ViewHolder associated with position 8 there. So we use a pooled ViewHolder, which was previously at position 3. When item 6 disappears on top, it goes to the cache, pushing 4 into the pool.</p> <p>The picture is different when we start scrolling in the opposite direction:</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*lcgR2438JvV5g3Sz.> Here we find a ViewHolder for position 5 in view cache and reuse it right away, without rebinding. And that seems to be the main use-case of the cache — to make scrolling in opposite direction, to the items we’ve just seen, more efficient. So if you have a news feed, the cache might be useless, since users won’t go back too often. But if it’s a list of things to choose from, say a gallery of wallpapers, you might want to extend the capacity of the cache.</p> <p>A couple of things to note here. First, what if we scroll up to view 3? Remember that the pool works like a stack, so if we didn’t do anything but scrolling since the last time we saw 3, then the ViewHolder 3 will be the last one to be put into the pool and thus is now chosen to be rebound at position 3. If the data didn’t change, we actually don’t need to do any rebinding. You should always check in your <code>onBindViewHolder()</code> if you actually need to change this TextView or that ImageView etc., and this is an example of a situation when you don’t.</p> <p>Second, notice that there is always no more than one item (per view type) in the pool while scrolling! (Of course, if you have a multi-column grid with <em>n</em> columns, then you’ll have <em>n</em> items in the pool.) The other items that ended up in the pool via scenarios 2–5, just stay there uselessly during scrolling.</p> <p>Now let’s look at a scenario, in which, by contrast, lots of items go into the pool: calling <code>notifyDataSetChanged()</code>(or <code>notifyItemRangeChanged()</code>with some wide range):</p> <p><img alt src=http://i.vjob.top:8000/imgs/20220306_0*wywfZF1PM6PCtRoH.> All the ViewHolders become invalid, cache is not a suitable place for them, and they all try to go to pool. There might be not enough space for them, so some unlucky ones will be garbage collected and then created again. In contrast to scrolling, you might want a bigger pool in this situation. Another case in which a big pool is useful is jumping from one position to another programmatically via <code>scrollToPosition()</code>.</p> <p>So how do we choose the optimal size of the pool? It seems that the optimal strategy is to extend the pool right before you’ll need it to be big, and shrink it right afterwards. One dirty way to implement this is the following:</p> <pre><code>**recyclerView**.getRecycledViewPool().setMaxRecycledViews(0, 20);**adapter**.notifyDataSetChanged();**new** Handler().post(**new** Runnable() { @Override **public void** run() { **recyclerView**.getRecycledViewPool()  
 .setMaxRecycledViews(0, 1); }});
</code></pre> <p><strong>Continued here:</strong></p> <p><a href=https://medium.com/@pavelshmakov/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-continued-d81c631a2b91#.dcsykhoh9>https://medium.com/@pavelshmakov/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-continued-d81c631a2b91</a></p> <p><a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#a02e>^</a> ¹ In fact, even understanding public API of RecyclerView requires you to know some of the inner workings. For example, the javadoc to <code>setHasStableIds()</code> method tells you nothing about why would you want to use it.</p> <p><a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#0c01>^</a> ² E.g. the correct view type is set in <code>createViewHolder()</code> method right after the Adapter call, and the field is package local, so you can’t set it yourself.</p> <p><a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#9b88>^</a> ³An example when this happens: change the item, so that it’s view type changes, call <code>notifyItemChanged()</code>. Also, disable change animations in your ItemAnimator, otherwise scenario 2 will happen.</p> <p><a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#c3f9>^</a> ⁴ One other example of View being in transient state is EditText with some text being selected or in the process of editing.</p> <p><a href=http://0a34>^</a> ⁵ The recyclability and transient state checks come <em>before</em> selection between cache and pool, which to be honest doesn’t make much sense to me, since views in cache are supposed to reappear exactly in the state they were when disappearing.</p> <p><a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714#8179>^</a> ⁶ In support version 23 this mechanism is broken by a simple off-by-one indexing mistake. The number of ViewHolders in the cache alternates between 1 and 2 as we recycle ViewHolders one by one.</p> <p>原文链接： <a href=https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714>https://medium.com/android-news/anatomy-of-recyclerview-part-1-a-search-for-a-viewholder-404ba3453714</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../10%20Ways%20to%20Improve%20Your%20Android%20App%27s%20Performance/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 10 Ways to Improve Your Android App's Performance" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 10 Ways to Improve Your Android App's Performance </div> </div> </a> <a href=../Android%E6%8F%92%E4%BB%B6%E5%8C%96%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94Hook%E6%9C%BA%E5%88%B6%E4%B9%8BBinder%20Hook/ class="md-footer__link md-footer__link--next" aria-label="下一页: Android插件化原理解析——Hook机制之Binder Hook" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Android插件化原理解析——Hook机制之Binder Hook </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 - 3022 <span style=float:right><a href=http://beian.miit.gov.cn/ >鄂ICP备19027194号-2</a></span> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script> <script src=../../assets/javascripts/bundle.8aa65030.min.js></script> </body> </html>