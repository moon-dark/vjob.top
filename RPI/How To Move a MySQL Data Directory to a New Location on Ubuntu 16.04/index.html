<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=http://vjob.top/RPI/How%20To%20Move%20a%20MySQL%20Data%20Directory%20to%20a%20New%20Location%20on%20Ubuntu%2016.04/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.1"><title>How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 - 微站</title><link rel=stylesheet href=../../assets/stylesheets/main.e8d9bf0c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Source Code Pro"}</style><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-1604-digitalocean-digitalocean-homepage class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=微站 class="md-header__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../static/img/avatar.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 微站 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../%E5%B0%86%E6%A0%91%E8%8E%93%E6%B4%BERaspberry%20Pi%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8%28WiFi%E7%83%AD%E7%82%B9AP%2CRTL8188CUS%E8%8A%AF%E7%89%87%29/ class="md-tabs__link md-tabs__link--active"> 树莓派 </a> </li> <li class=md-tabs__item> <a href=../../Bash/ class=md-tabs__link> Bash </a> </li> <li class=md-tabs__item> <a href=../../Python/ class=md-tabs__link> Python </a> </li> <li class=md-tabs__item> <a href=../../%E7%AE%97%E6%B3%95/ class=md-tabs__link> 算法 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=微站 class="md-nav__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../static/img/avatar.png alt=logo> </a> 微站 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> 主页 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主页 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 主页 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> 微站 </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> 关于 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> 树莓派 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=树莓派 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 树莓派 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E5%B0%86%E6%A0%91%E8%8E%93%E6%B4%BERaspberry%20Pi%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8%28WiFi%E7%83%AD%E7%82%B9AP%2CRTL8188CUS%E8%8A%AF%E7%89%87%29/ class=md-nav__link> 将树莓派Raspberry Pi设置为无线路由器(WiFi热点AP,RTL8188CUS芯片) </a> </li> <li class=md-nav__item> <a href=../Using%20Raspberry%20Pi%20for%20Laravel%20developing/ class=md-nav__link> Using Raspberry Pi for Laravel developing </a> </li> <li class=md-nav__item> <a href=../VNC%20setup%20on%20Raspberry%20Pi%20from%20Ubuntu/ class=md-nav__link> VNC setup on Raspberry Pi from Ubuntu </a> </li> <li class=md-nav__item> <a href=../%E8%AE%BE%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8%E5%A4%96%E7%BD%AE%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8/ class=md-nav__link> 设置树莓派使用外置硬盘启动 </a> </li> <li class=md-nav__item> <a href=../%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE2%E4%B8%8A%E5%AE%89%E8%A3%85%20Chromium%20%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%8A%20Google%20%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5%E6%B3%95/ class=md-nav__link> 在树莓派2上安装 Chromium 浏览器及 Google 拼音输入法 </a> </li> <li class=md-nav__item> <a href=../%E4%B8%BA%E6%A0%91%E8%8E%93%E6%B4%BEDIY%E4%B8%80%E6%AC%BE%E9%AB%98%E9%80%9F%E7%A8%B3%E5%AE%9A%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1/ class=md-nav__link> 为树莓派DIY一款高速稳定的无线网卡 </a> </li> <li class=md-nav__item> <a href=../%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B6%E2%80%94%E2%80%94%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9_%E8%80%81%E5%BE%902014-CSDN%E5%8D%9A%E5%AE%A2_%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9/ class=md-nav__link> 树莓派开发系列教程6——树莓派做wifi热点 老徐2014 CSDN博客 树莓派做wifi热点 </a> </li> <li class=md-nav__item> <a href=../%E6%A0%91%E8%8E%93%E6%B4%BEwifi%E7%A0%B4%E8%A7%A3%E6%95%B4%E7%90%86%20-%20FindHao/ class=md-nav__link> 树莓派wifi破解整理 FindHao </a> </li> <li class=md-nav__item> <a href=../%E6%A0%91%E8%8E%93%E6%B4%BE%E9%A6%99%E6%A9%99%E6%B4%BE%E6%97%A0%E7%BA%BF%E6%92%AD%E6%94%BE%EF%BC%8C%E5%AE%9E%E7%8E%B0DLNA%E4%B8%8EAirPlay%E5%8D%8F%E8%AE%AE%E6%97%A0%E7%BA%BF%E9%9F%B3%E7%AE%B1/ class=md-nav__link> 树莓派香橙派无线播放，实现DLNA与AirPlay协议无线音箱 </a> </li> <li class=md-nav__item> <a href=../SSH%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5/ class=md-nav__link> SSH通过代理连接 </a> </li> <li class=md-nav__item> <a href=../Autossh%20and%20Systemd%20Service/ class=md-nav__link> Autossh and Systemd Service </a> </li> <li class=md-nav__item> <a href=../Copying%20MySQL%20Databases%20to%20Another%20Machine/ class=md-nav__link> Copying MySQL Databases to Another Machine </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-1604-digitalocean-digitalocean-homepage class=md-nav__link> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 | DigitalOcean DigitalOcean Homepage </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#step-1-moving-the-mysql-data-directory class=md-nav__link> Step 1 — Moving the MySQL Data Directory </a> </li> <li class=md-nav__item> <a href=#step-2-pointing-to-the-new-data-location class=md-nav__link> Step 2 — Pointing to the New Data Location </a> </li> <li class=md-nav__item> <a href=#step-3-configuring-apparmor-access-control-rules class=md-nav__link> Step 3 — Configuring AppArmor Access Control Rules </a> </li> <li class=md-nav__item> <a href=#step-4-restarting-mysql class=md-nav__link> Step 4 — Restarting MySQL </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> Conclusion </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Latest%20Version%20of%20Firefox%20and%20Thunderbird%20on%20a%20Raspberry%20Pi%20%5Bobsolete%5D/ class=md-nav__link> Latest Version of Firefox and Thunderbird on a Raspberry Pi [obsolete] </a> </li> <li class=md-nav__item> <a href=../OpenWrt%20%E4%BD%BF%E7%94%A8%20frp%20%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%20%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA/ class=md-nav__link> OpenWrt 使用 frp 实现内网穿透 准备工作 搭建内网穿透 文章评论 </a> </li> <li class=md-nav__item> <a href=../%E8%A7%A3%E5%86%B3%E6%A0%91%E8%8E%93%E6%B4%BESSH%E7%99%BB%E5%BD%95%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98_Maoning%20Guan%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2/ class=md-nav__link> 解决树莓派SSH登录缓慢的问题 Maoning Guan的博客 CSDN博客 </a> </li> <li class=md-nav__item> <a href=../Reading%20privileged%20memory%20with%20a%20side-channel/ class=md-nav__link> Reading privileged memory with a side channel </a> </li> <li class=md-nav__item> <a href=../Install%20Latest%20ReadyMedia%20miniDLNA%20Raspberry%20Pi/ class=md-nav__link> Install Latest ReadyMedia miniDLNA Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../%E4%BD%BF%E7%94%A8%20vcgencmd%20%E6%8C%87%E4%BB%A4%E6%9F%A5%E7%9C%8B%20Raspberry%20Pi%20%E7%9A%84%20CPU%20%E6%BA%AB%E5%BA%A6%E3%80%81%E9%81%8B%E8%A1%8C%E9%80%9F%E5%BA%A6%E8%88%87%E9%9B%BB%E5%A3%93%E7%AD%89%E8%B3%87%E8%A8%8A/ class=md-nav__link> 使用 vcgencmd 指令查看 Raspberry Pi 的 CPU 溫度、運行速度與電壓等資訊 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Bash/ class=md-nav__link> Bash </a> </li> <li class=md-nav__item> <a href=../../Python/ class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../%E7%AE%97%E6%B3%95/ class=md-nav__link> 算法 </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-1604-digitalocean-digitalocean-homepage class=md-nav__link> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 | DigitalOcean DigitalOcean Homepage </a> </li> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#step-1-moving-the-mysql-data-directory class=md-nav__link> Step 1 — Moving the MySQL Data Directory </a> </li> <li class=md-nav__item> <a href=#step-2-pointing-to-the-new-data-location class=md-nav__link> Step 2 — Pointing to the New Data Location </a> </li> <li class=md-nav__item> <a href=#step-3-configuring-apparmor-access-control-rules class=md-nav__link> Step 3 — Configuring AppArmor Access Control Rules </a> </li> <li class=md-nav__item> <a href=#step-4-restarting-mysql class=md-nav__link> Step 4 — Restarting MySQL </a> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> Conclusion </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04</h1> <h2 id=how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-1604-digitalocean-digitalocean-homepage>How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 | DigitalOcean DigitalOcean Homepage</h2> <p>### Introduction</p> <p>Databases grow over time, sometimes outgrowing the space on the file system. You can also run into I/O contention when they’re located on the same partition as the rest of the operating system. RAID, network block storage, and other devices can offer redundancy and other desirable features. Whether you’re adding more space, evaluating ways to optimize performance, or looking to take advantage of other storage features, this tutorial will guide you through relocating MySQL’s data directory.</p> <h2 id=prerequisites>Prerequisites</h2> <p>To complete this guide, you will need:</p> <ul> <li><strong>An Ubuntu 16.04 server with a non-root user with <code>sudo</code> privileges</strong>. You can learn more about how to set up a user with these privileges in our <a href=https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-16-04>Initial Server Setup with Ubuntu 16.04</a> guide.</li> <li><strong>A MySQL server</strong>. If you haven’t already installed MySQL, the <a href=https://www.digitalocean.com/community/tutorials/how-to-install-mysql-on-ubuntu-16-04>How To Install MySQL on Ubuntu 16.04</a> guide can help you.</li> </ul> <p>In this example, we’re moving the data to a block storage device mounted at <code>/mnt/volume-nyc1-01</code>. You can learn how to set one up in the <a href=https://www.digitalocean.com/community/tutorials/how-to-use-block-storage-on-digitalocean>How To Use Block Storage on DigitalOcean</a> guide.</p> <p>No matter what underlying storage you use, this guide can help you move the data directory to a new location.</p> <h2 id=step-1-moving-the-mysql-data-directory>Step 1 — Moving the MySQL Data Directory</h2> <p>To prepare for moving MySQL’s data directory, let’s verify the current location by starting an interactive MySQL session using the administrative credentials.</p> <pre><code>1. mysql -u root -p



</code></pre> <p>When prompted, supply the MySQL root password. Then from the MySQL prompt, select the data directory:</p> <pre><code>1. select @@datadir;



</code></pre> <pre><code>Output+-----------------+
| @@datadir       |
+-----------------+
| /var/lib/mysql/ |
+-----------------+
1 row in set (0.00 sec)


</code></pre> <p>This output confirms that MySQL is configured to use the default data directory, <code>/var/lib/mysql/,</code> so that’s the directory we need to move. Once you’ve confirmed this, type <code>exit</code> to leave the monitor.</p> <p>To ensure the integrity of the data, we’ll shut down MySQL before we actually make changes to the data directory:</p> <pre><code>1. sudo systemctl stop mysql



</code></pre> <p><code>systemctl</code> doesn’t display the outcome of all service management commands, so if you want to be sure you’ve succeeded, use the following command:</p> <pre><code>1. sudo systemctl status mysql



</code></pre> <p>You can be sure it’s shut down if the final line of the output tells you the server is stopped:</p> <pre><code>Output. . .
Jul 18 11:24:20 ubuntu-512mb-nyc1-01 systemd[1]: Stopped MySQL Community Server.

</code></pre> <p>Now that the server is shut down, we’ll copy the existing database directory to the new location with <code>rsync</code>. Using the <code>-a</code> flag preserves the permissions and other directory properties, while<code>-v</code> provides verbose output so you can follow the progress.</p> <p><strong>Note:</strong> Be sure there is no trailing slash on the directory, which may be added if you use tab completion. When there’s a trailing slash, <code>rsync</code> will dump the contents of the directory into the mount point instead of transferring it into a containing <code>mysql</code> directory:</p> <pre><code>1. sudo rsync -av /var/lib/mysql /mnt/volume-nyc1-01



</code></pre> <p>Once the <code>rsync</code> is complete, rename the current folder with a .bak extension and keep it until we’ve confirmed the move was successful. By re-naming it, we’ll avoid confusion that could arise from files in both the new and the old location:</p> <pre><code>1. sudo mv /var/lib/mysql /var/lib/mysql.bak



</code></pre> <p>Now we’re ready to turn our attention to configuration.</p> <h2 id=step-2-pointing-to-the-new-data-location>Step 2 — Pointing to the New Data Location</h2> <p>MySQL has several ways to override configuration values. By default, the <code>datadir</code> is set to <code>/var/lib/mysql</code> in the <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code> file. Edit this file to reflect the new data directory:</p> <pre><code>1. sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf



</code></pre> <p>Find the line that begins with <code>datadir=</code> and change the path which follows to reflect the new location.</p> <p>In our case, the updated file looks like the output below:</p> <p>/etc/mysql/mysql.conf.d/mysqld.cnf</p> <pre><code>. . .
datadir=/mnt/volume-nyc1-01/mysql
. . .

</code></pre> <p>This seems like the right time to bring up MySQL again, but there’s one more thing to configure before we can do that successfully.</p> <h2 id=step-3-configuring-apparmor-access-control-rules>Step 3 — Configuring AppArmor Access Control Rules</h2> <p>We’ll need to tell AppArmor to let MySQL write to the new directory by creating an alias between the default directory and the new location. To do this, edit the AppArmor <code>alias</code> file:</p> <pre><code>1. sudo nano /etc/apparmor.d/tunables/alias



</code></pre> <p>At the bottom of the file, add the following alias rule:</p> <pre><code>. . .
[label /etc/apparmor.d/tunables/alias]
alias /var/lib/mysql/ -&gt; /mnt/volume-nyc1-01/mysql/,
. . .

</code></pre> <p>For the changes to take effect, restart AppArmor:</p> <pre><code>1. sudo systemctl restart apparmor



</code></pre> <p><strong>Note:</strong> If you skipped the AppArmor configuration step, you would run into the following error message:</p> <pre><code>OutputJob for mysql.service failed because the control process 
exited with error code. See &quot;systemctl status mysql.service&quot; 
and &quot;journalctl -xe&quot; for details.

</code></pre> <p>The output from both <code>systemctl</code> and <code>journalctl</code> concludes with:</p> <pre><code>OutputJul 18 11:03:24 ubuntu-512mb-nyc1-01 systemd[1]: 
mysql.service: Main process exited, code=exited, status=1/FAILURE

</code></pre> <p>Since the messages don’t make an explicit connection between AppArmor and the data directory, this error can take some time to figure out.</p> <h2 id=step-4-restarting-mysql>Step 4 — Restarting MySQL</h2> <p>The next step is to start MySQL, but if you do, you’ll run into another error. This time, instead of an AppArmor issue, the error happens because the script <code>mysql-systemd-start</code> checks for the existence of either a directory, <code>-d</code>, or a symbolic link, <code>-L</code>, that matches two default paths. It fails if they’re not found:</p> <p>/usr/share/mysql/mysql-systemd-start</p> <pre><code>. . .
if [ ! -d /var/lib/mysql ] &amp;&amp; [ ! -L /var/lib/mysql ]; then
 echo &quot;MySQL data dir not found at /var/lib/mysql. Please create one.&quot;
 exit 1
fi

if [ ! -d /var/lib/mysql/mysql ] &amp;&amp; [ ! -L /var/lib/mysql/mysql ]; then
 echo &quot;MySQL system database not found. Please run mysql_install_db tool.&quot;
 exit 1
fi

. . .


</code></pre> <p>Since we need these to start the server, we will create the minimal directory structure to pass the script’s environment check.</p> <pre><code>1. sudo mkdir /var/lib/mysql/mysql -p



</code></pre> <p><em>Now</em> we’re ready to start MySQL.</p> <pre><code>1. sudo systemctl start mysql
2. sudo systemctl status mysql



</code></pre> <p>To make sure that the new data directory is indeed in use, start the MySQL monitor.</p> <pre><code>1. mysql -u root -p



</code></pre> <p>Look at the value for the data directory again:</p> <pre><code>Output+----------------------------+
| @@datadir                  |
+----------------------------+
| /mnt/volume-nyc1-01/mysql/ |
+----------------------------+
1 row in set (0.01 sec)

</code></pre> <p>Now that you’ve restarted MySQL and confirmed that it’s using the new location, take the opportunity to ensure that your database is fully functional. Once you’ve verified the integrity of any existing data, you can remove the backup data directory:</p> <pre><code>1. sudo rm -Rf /var/lib/mysql.bak



</code></pre> <p>Restart MySQL one final time to be sure that it works as expected:</p> <pre><code>1. sudo systemctl restart mysql
2. sudo systemctl status mysql



</code></pre> <h2 id=conclusion>Conclusion</h2> <p>In this tutorial, we’ve moved MySQL’s data directory to a new location and updated Ubuntu’s AppArmor ACLs to accommodate the adjustment. Although we were using a Block Storage device, the instructions here should be suitable for redefining the location of the data directory regardless of the underlying technology.</p> <p>For more on managing MySQL’s data directories, see these sections in the official MySQL documentation:</p> <ul> <li><a href=https://dev.mysql.com/doc/refman/5.7/en/data-directory.html>The Mysql Data Directory</a></li> <li><a href=https://dev.mysql.com/doc/refman/5.7/en/multiple-data-directories.html>Setting Up Multiple Data Directories</a></li> </ul> <p>原文链接： <a href=https://www.digitalocean.com/community/tutorials/how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-16-04>https://www.digitalocean.com/community/tutorials/how-to-move-a-mysql-data-directory-to-a-new-location-on-ubuntu-16-04</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../Copying%20MySQL%20Databases%20to%20Another%20Machine/ class="md-footer__link md-footer__link--prev" aria-label="上一页: Copying MySQL Databases to Another Machine" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> Copying MySQL Databases to Another Machine </div> </div> </a> <a href=../Latest%20Version%20of%20Firefox%20and%20Thunderbird%20on%20a%20Raspberry%20Pi%20%5Bobsolete%5D/ class="md-footer__link md-footer__link--next" aria-label="下一页: Latest Version of Firefox and Thunderbird on a Raspberry Pi [obsolete]" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Latest Version of Firefox and Thunderbird on a Raspberry Pi [obsolete] </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 - 3022 <span style=float:right><a href=http://beian.miit.gov.cn/ >鄂ICP备19027194号-2</a></span> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script> <script src=../../assets/javascripts/bundle.8aa65030.min.js></script> </body> </html>